<!DOCTYPE html><html lang="en-CA" dir="ltr" data-critters-container><head>
    <meta charset="utf-8">
    <title>Ignis Codis :  Annoying Cat Extension</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="logo.png">
  <style>:root{--theme-dark: #1e2019;--theme-dark-secondary: #393e41;--theme-light: #d3d0cb;--theme-accent: #e2c044;--theme-tertiary: #587b7f}button{transition:all .3s;color:var(--theme-accent)}button:hover,button:focus{background-color:var(--theme-accent);color:var(--theme-dark)}button{background-color:var(--theme-dark);border:1px solid var(--theme-accent);padding:.2rem 1rem;font-variant:small-caps;font-size:.9rem}body{font-size:1rem}h1{font-size:2.5rem}button{cursor:pointer}html{font-family:sans-serif,monospace}@media only screen and (max-width: 600px){html{font-size:16px}}@media only screen and (min-width: 600px){html{font-size:18px}}body{background-color:var(--theme-dark);color:var(--theme-light);padding:0;margin:0}*{transform:translateZ(0)}a{color:var(--theme-accent)}a:hover,a:focus{text-decoration:none;background-color:var(--theme-accent);color:var(--theme-dark)}markdown .language-ic-metadata{display:none}markdown p img{display:block;max-width:100%;max-height:40vh}code[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}
</style><link rel="stylesheet" href="styles-4SQKIKAV.css" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles-4SQKIKAV.css"></noscript><style ng-app-id="ng">[_nghost-ng-c3775897885]{display:grid;height:100vh;overflow:hidden;box-sizing:border-box;width:auto;position:relative}@media only screen and (max-width: 600px){[_nghost-ng-c3775897885]{background:linear-gradient(to bottom,var(--theme-dark-secondary),var(--theme-dark) 80px 100%);padding:5px 0 0;grid-template-columns:1fr 1fr;grid-template-rows:auto 1fr auto;grid-template-areas:"logo social" "content content" "nav nav"}[_nghost-ng-c3775897885]   [data-ic-logo][_ngcontent-ng-c3775897885]{margin-left:30px}[_nghost-ng-c3775897885]   [data-ic-social-buttons][_ngcontent-ng-c3775897885]{justify-self:flex-end;margin-right:30px}[_nghost-ng-c3775897885]   main[_ngcontent-ng-c3775897885]{border-width:1px 0 0 0;border-style:solid;padding:10px;border-color:var(--theme-tertiary)}}@media only screen and (min-width: 600px){[_nghost-ng-c3775897885]{background:linear-gradient(to right,var(--theme-dark-secondary),var(--theme-dark) 125px 100%);padding:30px 0 30px 5px;grid-template-columns:100px 1fr;grid-template-rows:auto auto 1fr;grid-gap:20px;grid-template-areas:"logo content" "nav  content" "social content"}[_nghost-ng-c3775897885]   [data-ic-social-buttons][_ngcontent-ng-c3775897885]{justify-self:flex-start;align-self:flex-start}[_nghost-ng-c3775897885]   main[_ngcontent-ng-c3775897885]{border-width:0 0 0 1px;border-style:solid;border-color:var(--theme-tertiary)}}[data-ic-logo][_ngcontent-ng-c3775897885]{grid-area:logo}[data-ic-social-buttons][_ngcontent-ng-c3775897885]{grid-area:social;align-self:center}[data-ic-navigation][_ngcontent-ng-c3775897885]{grid-area:nav}main[_ngcontent-ng-c3775897885]{grid-area:content}main[_ngcontent-ng-c3775897885]   section[_ngcontent-ng-c3775897885]{max-width:800px}main[_ngcontent-ng-c3775897885]{overflow:auto;box-sizing:border-box;padding:30px;scrollbar-width:thin;scrollbar-color:var(--theme-light) var(--theme-tertiary)}</style><style ng-app-id="ng">[_nghost-ng-c1712305223]{display:flex}a[_ngcontent-ng-c1712305223]{display:block}a[_ngcontent-ng-c1712305223]:hover, a[_ngcontent-ng-c1712305223]:focus{background-color:transparent}img[_ngcontent-ng-c1712305223]{display:block;width:100%}@media only screen and (max-width: 600px){img[_ngcontent-ng-c1712305223]{max-width:55px}}@media only screen and (min-width: 600px){img[_ngcontent-ng-c1712305223]{max-width:150px}}</style><style ng-app-id="ng">a[_ngcontent-ng-c3947245871]{transition:all .3s;color:var(--theme-accent)}a[_ngcontent-ng-c3947245871]   [data-ic-icon][_ngcontent-ng-c3947245871]{--background-color: var(--theme-accent);padding:0}a[_ngcontent-ng-c3947245871]:hover, a[_ngcontent-ng-c3947245871]:focus{background-color:var(--theme-accent);color:var(--theme-dark)}a[_ngcontent-ng-c3947245871]:hover   [data-ic-icon][_ngcontent-ng-c3947245871], a[_ngcontent-ng-c3947245871]:focus   [data-ic-icon][_ngcontent-ng-c3947245871]{--background-color: var(--theme-dark)}a.active[_ngcontent-ng-c3947245871]{background-color:var(--theme-dark-secondary);cursor:unset;color:var(--theme-light)}a.active[_ngcontent-ng-c3947245871]   [data-ic-icon][_ngcontent-ng-c3947245871]{--background-color: var(--theme-light)}[_nghost-ng-c3947245871]{display:flex;align-items:center;justify-content:flex-end;width:100%}@media only screen and (min-width: 600px){[_nghost-ng-c3947245871]{justify-content:space-evenly}}a[_ngcontent-ng-c3947245871]{transition:all .3s;display:flex;border-radius:5px}a[_ngcontent-ng-c3947245871]{margin:10px}[data-ic-icon][_ngcontent-ng-c3947245871]{--font-size: 1.5rem}</style><style ng-app-id="ng">a[_ngcontent-ng-c632272801]{transition:all .3s;color:var(--theme-accent)}a[_ngcontent-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{--background-color: var(--theme-accent);padding:0}a[_ngcontent-ng-c632272801]:hover, a[_ngcontent-ng-c632272801]:focus{background-color:var(--theme-accent);color:var(--theme-dark)}a[_ngcontent-ng-c632272801]:hover   [data-ic-icon][_ngcontent-ng-c632272801], a[_ngcontent-ng-c632272801]:focus   [data-ic-icon][_ngcontent-ng-c632272801]{--background-color: var(--theme-dark)}a.active[_ngcontent-ng-c632272801]{background-color:var(--theme-dark-secondary);cursor:unset;color:var(--theme-light)}a.active[_ngcontent-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{--background-color: var(--theme-light)}[_nghost-ng-c632272801]{display:flex}@media only screen and (max-width: 600px){[_nghost-ng-c632272801]{flex-direction:row}[_nghost-ng-c632272801]   a[_ngcontent-ng-c632272801]{text-align:center;flex-grow:1}[_nghost-ng-c632272801]   .title[_ngcontent-ng-c632272801]{display:none}[_nghost-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{--font-size: 1.2rem}}@media only screen and (min-width: 600px){[_nghost-ng-c632272801]{flex-direction:column}[_nghost-ng-c632272801]   a[_ngcontent-ng-c632272801]{text-align:left}[_nghost-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{display:none}}a[_ngcontent-ng-c632272801]{background-color:var(--theme-dark);display:block;border:1px solid var(--theme-tertiary);box-sizing:border-box;padding:5px 15px;cursor:pointer;transition:all .3s;font-variant:small-caps;font-size:.9rem;text-decoration:none}</style><style ng-app-id="ng">[_nghost-ng-c1206199484]{--background-color: var(--theme-accent);--font-size: 1rem;display:contents}span[_ngcontent-ng-c1206199484]{background-color:var(--background-color);width:var(--font-size);height:var(--font-size)}a[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484]{background-color:var(--background-color)}a:hover[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a:hover   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a:active[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a:active   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484]{background-color:var(--background-color)}a.active[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a.active   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484]{background-color:var(--background-color)}</style><style ng-app-id="ng">.details[_ngcontent-ng-c1870341192]{margin-top:20px;font-size:.7rem;scrollbar-width:thin}.details[_ngcontent-ng-c1870341192]   .summary[_ngcontent-ng-c1870341192]{cursor:pointer;font-variant:small-caps}.article-metadata[_ngcontent-ng-c1870341192]{display:flex;flex-direction:column;justify-content:space-between;align-items:flex-start;flex-wrap:wrap}.article-metadata[_ngcontent-ng-c1870341192] > *[_ngcontent-ng-c1870341192]{padding:10px 0 0}@media only screen and (min-width: 600px){.article-metadata[_ngcontent-ng-c1870341192]{flex-direction:row}}</style><link rel="https://dev.to/bwca/annoying-cat-extension-4eaf"></head>
  <body><!--nghm-->
    <div data-ic-root _nghost-ng-c3775897885 class="ng-tns-c3775897885-0" ng-version="18.0.3" ngh="6" ng-server-context="ssg"><header _ngcontent-ng-c3775897885 data-ic-logo class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromTop" _nghost-ng-c1712305223 ngh="0"><a _ngcontent-ng-c1712305223 href="/home"><img _ngcontent-ng-c1712305223 src="./logo.png" alt="logo, depicting a ginger cat in a box"></a></header><nav _ngcontent-ng-c3775897885 data-ic-social-buttons class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromBottom" _nghost-ng-c3947245871 ngh="0"><a _ngcontent-ng-c3947245871 target="_blank" href="https://github.com/Bwca" title="GitHub"><span _ngcontent-ng-c3947245871 data-ic-icon iconname="github" _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/github.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span></a><a _ngcontent-ng-c3947245871 target="_blank" href="https://www.linkedin.com/in/volodymyr-yepishev" title="LinkedIn"><span _ngcontent-ng-c3947245871 data-ic-icon iconname="linkedin" _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/linkedin.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span></a></nav><nav _ngcontent-ng-c3775897885 data-ic-navigation class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromLeft" _nghost-ng-c632272801 ngh="1"><!----><a _ngcontent-ng-c632272801 routerlinkactive="active" title="home" href="/home" class="ng-star-inserted" style><span _ngcontent-ng-c632272801 data-ic-icon _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/home.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span><span _ngcontent-ng-c632272801 class="title">home</span></a><!----><!----><a _ngcontent-ng-c632272801 routerlinkactive="active" title="articles" href="/dev-articles" class="ng-star-inserted" style><span _ngcontent-ng-c632272801 data-ic-icon _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/book.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span><span _ngcontent-ng-c632272801 class="title">articles</span></a><!----><!----></nav><main _ngcontent-ng-c3775897885 class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromRight"><section _ngcontent-ng-c3775897885 class="ng-tns-c3775897885-0 ng-trigger ng-trigger-routeAnimations"><router-outlet _ngcontent-ng-c3775897885 class="ng-tns-c3775897885-0"></router-outlet><div _nghost-ng-c1870341192 data-ic-article-view class="ng-star-inserted" style ngh="5"><div _ngcontent-ng-c1870341192 data-ic-breadcrumbs _nghost-ng-c1373225446 class="ng-star-inserted" ngh="2"><div _ngcontent-ng-c1373225446><span _ngcontent-ng-c1373225446 class="ng-star-inserted"> / <a _ngcontent-ng-c1373225446 href="/dev-articles">Articles</a> /  Annoying Cat Extension </span><!----><!----><!----><!----></div></div><!----><section _ngcontent-ng-c1870341192 class="article-metadata"><section _ngcontent-ng-c1870341192 data-ic-accordion class="details ng-tns-c2942593920-1 ng-star-inserted" _nghost-ng-c2942593920 ngh="3"><button _ngcontent-ng-c2942593920 class="ng-tns-c2942593920-1"><span _ngcontent-ng-c1870341192 ngprojectas="summary" class="summary ng-tns-c2942593920-1">article metadata</span></button><br _ngcontent-ng-c2942593920 class="ng-tns-c2942593920-1"><!----></section><!----></section><section _ngcontent-ng-c1870341192 data-ic-markdown _nghost-ng-c1847889374 ngh="4"><markdown _ngcontent-ng-c1847889374 clipboard ngh="0"><pre><code class="language-ic-metadata">{
  "name": "Annoying Cat Extension",
  "series": null,
  "date": "2024-03-29",
  "lastModifiedDate": "2024-03-29",
  "author": "Volodymyr Yepishev",
  "tags": ["javascript", "tutorial"],
  "canonicalLink": "https://dev.to/bwca/annoying-cat-extension-4eaf"
}
</code></pre>
<h1>Annoying Cat Extension</h1>
<p><em>The link to the full code for this article is at the end of this article.</em></p>
<p>Once upon a time I was involved in adding an Easter egg to an application that once a year, on April 1, would cause a famous doge meme to slide out from the left side of the screen. When hovered over, the doge would hide, to come back after some time. It was hidden from serious people in production by a boolean flag, but the development team loved it.</p>
<p>So recently I thought why not create a bookmarklet or extension to get similar experience anywhere, any time? In the end I decided to go with browser extension, since packing an image as base64 into a bookmarklet makes it too big to be used as a bookmarklet and would only work when pasted into browser's console, I also decided I would want to make it more flexible this time, with the image sliding from random side of the screen, left, right, top or bottom.</p>
<p>Now, I do not have a doge meme dog to take a picture of, but I still have a picture of my cat peeping out of a box, which looks perfect for this type of thing, though the approach I intend to use during the implementation will not rely on the image dimensions, so any picture would do really.</p>
<p><img src="articles/2024-03-29-writing-annoying-image-browser-extension/..%2F..%2Fbrowser-extension_annoying-cat%2Fassets%2Fannoying-cat.png" alt="annoying-cat.png"></p>
<p>Being a developer, removing the background on the image was the hardest part, but I digress.</p>
<p>First we create a folder for the extension and add the assets folder and the image to it, i.e. in <code>assets/annoying-cat.png</code>. Having a folder is not necessary, but it keeps things neat and tidy. Also, storing the image as a file compared to base64 string in the javascript file is also less messy when it comes to reading the code.</p>
<p>The next step is to add <code>manifest.json</code>, which should have <code>web_accessible_resources</code> section to allow using the image from assets:</p>
<pre><code class="language-json">{
  "manifest_version": 3,
  "name": "Annoying Cat",
  "version": "1.0",
  "description": "Annoys you.",
  "permissions": [
    "activeTab"
  ],
  "content_scripts": [
    {
      "matches": ["&lt;all_urls&gt;"],
      "js": ["content.js"]
    }
  ],
  "web_accessible_resources": [
    {
      "resources": ["assets/annoying-cat.png"],
      "matches": ["&lt;all_urls&gt;"]
    }
  ]
}
</code></pre>
<p>I don't create browser extensions too often, so I had to look it up, as I originally went with relative image path and failed miserably.</p>
<p>Now for <code>content.js</code>, I decided not to just pile all the code there, but put it inside an IIFE in case I ever want to extract it for a bookmarklet or to paste it into console. As a tribute to <del>real</del> other programming languages, I decided to call it main:</p>
<pre><code class="language-javascript">(function main() {
    /** here be annoying cat */
})()
</code></pre>
<p>First of all, let us add some basic stuff, like enumeration to determine direction from which the image is going to appear as well as the css classes we use to manipulate it:</p>
<pre><code class="language-javascript">const DIRECTIONS = {
    TOP: 3,
    RIGHT: 1,
    BOTTOM: 2,
    LEFT: 4,
};

const CSS_CLASSES = {
    IMAGE: 'annoying-cat-image',
    SHOW: 'annoying-cat-image-show',
    HIDE: 'annoying-cat-image-hide',
};
</code></pre>
<p>To utilize those classes, we need to create them and attach to the document's head. Let's make the image positioned fixed, with ridiculous z-index and outside the viewport initially, with some transitions for sliding out and hiding (this will happen when the image receives mouse over event).</p>
<pre><code class="language-javascript">function addStyles() {
    const style = document.createElement('style');
    style.innerHTML = `
    .${CSS_CLASSES.IMAGE} {
        position: fixed;
        left: -100vw;
        top: -100vh;
        z-index: ${Number.MAX_SAFE_INTEGER}
    }
    
    .${CSS_CLASSES.HIDE} {
        transition-property: top, bottom, left, right;
        transition-duration: 0.2s;
        transition-timing-function: ease-out;
    }
    
    .${CSS_CLASSES.SHOW} {
        transition-property: top, bottom, left, right;
        transition-duration: 1s;
        transition-timing-function: ease-out;
    }`;
    
    document.head.appendChild(style);
}
</code></pre>
<p>Creating the image itself and adding source to it can be done using a couple of functions, I like to separate setting the source, because it might be URL or base64, which makes it easier to change if it is a separate function:</p>
<pre><code class="language-javascript">function createImage() {
    const el = document.createElement('img');
    el.src = getImageSource();
    el.classList.add(CSS_CLASSES.IMAGE);
    document.body.appendChild(el);
    return el;
}

function getImageSource() {
    return chrome.runtime.getURL('assets/annoying-cat.png');
}
</code></pre>
<p>As we do not want to have the image sliding out from the same spots, we need a function to get random numbers, so we can get the random side, and the left offset if it is top/bottom or top offset if it is left/right. This means our function would have to be able to generate a random number between two given values:</p>
<pre><code class="language-javascript">function getRandomNumber(max, min = 1) {
    const minCeiled = Math.ceil(min);
    const maxFloored = Math.floor(max);
    return Math.floor(Math.random() * (maxFloored - minCeiled + 1) + minCeiled);
}
</code></pre>
<p>Having this function we can create a function that generates a random direction, since our directions are a range from 1-4, we need a random number in that range:</p>
<pre><code class="language-javascript">function getDirection() {
    return getRandomNumber(4);
}
</code></pre>
<p>Now, for an interesting part: since we do not want to rely on hard-coding width/height of the image, but calculating them on the fly, we cannot completely hide it, or those values would be 0, we would have to set the image's visibility to hidden instead. Moreover, since the image is going to appear from a random side and position, it means we would have to reposition it before changing its visibility to visible and allowing its appearance via css classes with transitions. This means the invisible image will be flying through the screen at some point.</p>
<p>In order to avoid awkward situation with flying image becoming visible before we want it to, let us delegate this event to a function, which would add the show class to the image, adjust its visibility and perform a callback to set its other properties, which will vary, depending on the side of the screen, from which the image appears:</p>
<pre><code class="language-javascript">function show(slideCb) {
    setTimeout(() =&gt; {
        img.classList.add(CSS_CLASSES.SHOW);
        img.style.visibility = 'visible';
        slideCb();
    }, 1000);
}
</code></pre>
<p>To handle all 4 cases for each screen side, we can add 4 function to handle each case (could probably be reduced to 1), they are rather similar in structure, they reposition the image and set properties for it to slide out <del>annoyingly</del>.</p>
<p>The pattern is the following: we position the image behind the side, from which it is supposed to emerge, rotating it accordingly, get random position for its left or top offset and showing it with a delay. Note the usage of <code>window.getComputedStyle</code> to dynamically obtain its width and height.</p>
<pre><code class="language-javascript">function slideFromTop(img) {
    img.style.visibility = 'hidden';
    img.style.transformOrigin = 'unset';
    img.style.top = -1 * window.getComputedStyle(img).height.replace('px', '') + 'px';
    img.style.left = getRandomNumber(window.innerWidth - window.getComputedStyle(img).width.replace('px', '')) + 'px';
    img.style.transform = 'scaleY(-1)';
    show(() =&gt; {
        img.style.top = '0';
    });
}

function slideFromBottom(img) {
    img.style.visibility = 'hidden';
    img.style.transformOrigin = 'unset';
    img.style.top = 'unset';
    img.style.left = getRandomNumber(window.innerWidth - window.getComputedStyle(img).width.replace('px', '')) + 'px';
    img.style.transform = 'scaleY(1)';
    img.style.bottom = -1 * window.getComputedStyle(img).height.replace('px', '') + 'px';
    show(() =&gt; {
        img.style.bottom = '0';
    });
}

function slideFromLeft(img) {
    img.style.visibility = 'hidden';
    img.style.transformOrigin = 'left top';
    img.style.top = getRandomNumber(window.innerHeight - window.getComputedStyle(img).width.replace('px', '')) + 'px';
    img.style.transform = 'rotate(90deg)';
    img.style.left = -1 * window.getComputedStyle(img).height.replace('px', '') + 'px';
    show(() =&gt; {
        img.style.left = window.getComputedStyle(img).height;
    });
}

function slideFromRight(img) {
    img.style.visibility = 'hidden';
    img.style.transformOrigin = 'right top';
    img.style.top = getRandomNumber(window.innerHeight - window.getComputedStyle(img).width.replace('px', '')) + 'px';
    img.style.left = 'unset';
    img.style.transform = 'rotate(-90deg)';
    img.style.right = -1 * window.getComputedStyle(img).height.replace('px', '') + 'px';
    show(() =&gt; {
        img.style.right = window.getComputedStyle(img).height;
    });
}
</code></pre>
<p>With these handlers ready, it is time to write a function that would call the appropriate handler, for the given direction:</p>
<pre><code class="language-javascript">function slideOut(img, dir) {
    img.classList.remove(CSS_CLASSES.HIDE);
    img.classList.add(CSS_CLASSES.SHOW);
    if (dir === DIRECTIONS.TOP) {
        slideFromTop(img);
    } else if (dir === DIRECTIONS.BOTTOM) {
        slideFromBottom(img);
    } else if (dir === DIRECTIONS.LEFT) {
        slideFromLeft(img);
    } else if (dir === DIRECTIONS.RIGHT) {
        slideFromRight(img);
    }
}
</code></pre>
<p>Showing image is only a part of our intention, we also need a function to reset it back to hiding, with a fast transition:</p>
<pre><code class="language-javascript">function reset(img, dir) {
    img.classList.remove(CSS_CLASSES.SHOW);
    img.classList.add(CSS_CLASSES.HIDE);
    const offset =
      -1 * window.getComputedStyle(img).height.replace("px", "") + "px";
    if (dir === DIRECTIONS.TOP) {
      img.style.top = offset;
    } else if (dir === DIRECTIONS.BOTTOM) {
      img.style.bottom = offset;
    } else if (dir === DIRECTIONS.LEFT) {
      img.style.left = offset;
    } else if (dir === DIRECTIONS.RIGHT) {
      img.style.right = offset;
    }
}
</code></pre>
<p>The function to make image slide out from random direction can be crafted using a factory, which accepts the image itself and a cooldown timer:</p>
<pre><code class="language-javascript">function createSlideOutFunction(img, showUpCoolDown) {
    let slideDirection;
    
    return () =&gt; {
        reset(img, slideDirection);
        setTimeout(() =&gt; {
            slideDirection = getDirection();
            slideOut(img, slideDirection);
        }, showUpCoolDown);
    };
}
</code></pre>
<p>With all needed functions in place, all that is left is to evoke them in a proper sequence:</p>
<pre><code class="language-javascript">  addStyles();

  const img = createImage();
  // annoy every 2 seconds
  const showUpCoolDown = 2 * 1000;
  const slideOutRandomly = createSlideOutFunction(img, showUpCoolDown);
  img.addEventListener("mouseenter", slideOutRandomly);
  slideOutRandomly();
</code></pre>
<p>Now the unpacked extension can be loaded in chrome :)</p>
<p>The source code is available on <a href="https://github.com/Bwca/browser-extension_annoying-cat">github</a>.</p>
</markdown><!----></section></div><!----></section></main></div>
  <link rel="modulepreload" href="chunk-76TOWMZK.js"><script src="polyfills-UD7OJCHV.js" type="module"></script><script src="scripts-MI2AUGIN.js" defer></script><script src="main-66OU5UQS.js" type="module"></script>

<script id="ng-state" type="application/json">{"341425767":{"b":[{"metadata":{"name":"Create a Custom eslint Rule with Typescript","series":null,"date":"2021-04-02","lastModifiedDate":"2021-07-11","author":"Volodymyr Yepishev","tags":["typescript","tutorial","eslint","npm"],"canonicalLink":"https://dev.to/bwca/create-a-custom-eslint-rule-with-typescript-4j3d"},"path":"2021-04-02-create-a-custom-eslint-rule-with-typescript.md"},{"metadata":{"name":"Create Object Property String Path Generator with Typescript","series":null,"date":"2021-04-13","lastModifiedDate":"2021-04-13","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular","react"],"canonicalLink":"https://dev.to/bwca/create-object-property-string-path-generator-with-typescript-13e3"},"path":"2021-04-13-create-object-property-string-path-generator-with-typescript/2021-04-13-create-object-property-string-path-generator-with-typescript.md"},{"metadata":{"name":"Build Entity-Friendly react-router Paths Generator with Typescript","series":null,"date":"2021-05-12","lastModifiedDate":"2021-05-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/build-entity-friendly-react-router-paths-generator-with-typescript-fpd"},"path":"2021-05-12-build-entity-friendly-react-router-path-generator-with-typescript.md"},{"metadata":{"name":"Split Collection Based on Enum Value with Typescript","series":null,"date":"2021-06-28","lastModifiedDate":"2021-06-28","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/split-collection-based-on-enum-value-with-typescript-4g3b"},"path":"2021-06-28-split-collection-based-on-enum-values/2021-06-28-split-collection-based-on-enum-values.md"},{"metadata":{"name":"Make Your Own Linkedin Promoted Posts Blocker","series":null,"date":"2021-07-14","lastModifiedDate":"2021-07-14","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/make-your-own-linkedin-promoted-posts-blocker-fj5"},"path":"2021-07-14-make-you-own-linkedin-promoted-posts-blocker.md"},{"metadata":{"name":"How I Decided to Write React cli and How it Went","series":null,"date":"2021-08-08","lastModifiedDate":"2021-08-08","author":"Volodymyr Yepishev","tags":["angular"],"canonicalLink":"https://dev.to/bwca/how-i-decided-to-write-react-cli-and-how-it-went-4f19"},"path":"2021-08-08-how-i-decided-to-write-react-cli-and-how-it-went/2021-08-08-how-i-decided-to-write-react-cli-and-how-it-went.md"},{"metadata":{"name":"Remove Double Imports with Regular Expression","series":null,"date":"2022-03-29","lastModifiedDate":"2022-03-29","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/remove-double-imports-with-regular-expression-47af"},"path":"2022-03-29-remove-double-imports-with-regular-expression.md"},{"metadata":{"name":"Decorating React Hook with Typescript","series":null,"date":"2022-04-12","lastModifiedDate":"2022-04-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/decorating-react-hook-with-typescript-bd9"},"path":"2022-04-12-decorating-react-hook-with-typescript.md"},{"metadata":{"name":"Override Method Return with a Decorator","series":null,"date":"2022-04-22","lastModifiedDate":"2022-04-22","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/override-method-return-with-a-decorator-1bii"},"path":"2022-04-22-change-api-response-with-a-decorator.md"},{"metadata":{"name":"Turn Angular Application into Chrome Extension","series":null,"date":"2022-05-25","lastModifiedDate":"2022-05-25","author":"Volodymyr Yepishev","tags":["angular","tutorial","chrome","extension"],"canonicalLink":"https://dev.to/bwca/turn-angular-application-into-chrome-extension-2mkn"},"path":"2022-05-25-turn-angular-application-into-chrome-extension.md"},{"metadata":{"name":"Typed Dates Conversion with Typescript","series":null,"date":"2022-06-30","lastModifiedDate":"2022-06-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","generics","conversion","date","moment"],"canonicalLink":"https://dev.to/bwca/typed-dates-conversion-with-typescript-49n7"},"path":"2022-06-30-typed-date-conversion-with-typescript.md"},{"metadata":{"name":"Weekday - Date - Month type","series":null,"date":"2022-07-29","lastModifiedDate":"2022-07-29","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/weekday-date-month-type-26j4"},"path":"2022-07-29-week-day-date-month-type.md"},{"metadata":{"name":"An Alternative Way of Creating Enumerations in Typescript","series":null,"date":"2022-08-03","lastModifiedDate":"2022-08-03","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/an-alternative-way-of-creating-enumerations-in-typescript-579k"},"path":"2022-08-03-an-alternative-way-of-creating-enumerations-in-typescript.md"},{"metadata":{"name":"Create a Static Class in Typescript","series":null,"date":"2022-08-12","lastModifiedDate":"2022-08-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/create-a-static-class-in-typescript-5ao1"},"path":"2022-08-12-create-static-class-in-typescript.md"},{"metadata":{"name":"Typescript Class Mixins","series":null,"date":"2022-08-20","lastModifiedDate":"2022-08-20","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/typescript-class-mixins-3hib"},"path":"2022-08-20-typescript-class-mixins.md"},{"metadata":{"name":"Using Classes Inside React's Functional Components","series":null,"date":"2022-08-22","lastModifiedDate":"2022-08-22","author":"Volodymyr Yepishev","tags":["typescript","react","tutorial"],"canonicalLink":"https://dev.to/bwca/using-classes-inside-reacts-functional-components-oj3"},"path":"2022-08-22-using-classes-inside-react-functional-component.md"},{"metadata":{"name":"Debouncing Component Methods in Angular","series":null,"date":"2022-08-29","lastModifiedDate":"2022-08-29","author":"Volodymyr Yepishev","tags":["typescript","angular","tutorial"],"canonicalLink":"https://dev.to/bwca/debouncing-component-methods-in-angular-34im"},"path":"2022-08-29-debouncing-component-methods-in-angular.md"},{"metadata":{"name":"A Trick to Further Breaking Down Angular Components","series":null,"date":"2022-09-02","lastModifiedDate":"2022-09-02","author":"Volodymyr Yepishev","tags":["typescript","angular"],"canonicalLink":"https://dev.to/bwca/a-trick-to-further-breaking-down-angular-components-1i8a"},"path":"2022-09-02-a-trick-to-further-breaking-angular-components.md"},{"metadata":{"name":"Typed Enum Flipping in Typescript","series":null,"date":"2022-11-09","lastModifiedDate":"2022-11-09","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/typed-enum-flipping-in-typescript-2ce9"},"path":"2022-11-09-typed-enum-flipping-in-typescript.md"},{"metadata":{"name":"Typed Filtering with Generics in Typescript","series":null,"date":"2022-12-01","lastModifiedDate":"2022-12-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","generics"],"canonicalLink":"https://dev.to/bwca/typed-filtering-with-generics-in-typescript-204f"},"path":"2022-12-01-typed-filtering-with-generics.md"},{"metadata":{"name":"Template Driving Reactive Form Validation in Angular","series":null,"date":"2023-05-15","lastModifiedDate":"2023-05-15","author":"Volodymyr Yepishev","tags":["angular"],"canonicalLink":"https://dev.to/bwca/template-driving-reactive-form-validation-in-angular-302e"},"path":"2023-05-15-template-driving-reactive-form-validation/2023-05-15-template-driving-reactive-form-validation-in-angular.md"},{"metadata":{"name":"Detect Invalid FormGroup Tree in Angular","series":null,"date":"2023-05-17","lastModifiedDate":"2023-05-17","author":"Volodymyr Yepishev","tags":["angular","debugger"],"canonicalLink":"https://dev.to/bwca/detect-invalid-formgroup-tree-in-angular-1ed"},"path":"2023-05-17-detect-invalid-form-group-tree-in-angular/2023-05-17-detect-invalid-form-group-tree-in-angular.md"},{"metadata":{"name":"Safe Route Param Injection in Angular with a Decorator","series":null,"date":"2023-07-22","lastModifiedDate":"2023-07-28","author":"Volodymyr Yepishev","tags":["angular","tutorial","routing","generics"],"canonicalLink":"https://dev.to/bwca/safe-route-param-injection-in-angular-with-a-decorator-1lk7"},"path":"2023-07-22-safe-route-param-injection-in-angular-with-a-decorator.md"},{"metadata":{"name":"Deep Readonly Generic in Typescript","series":null,"date":"2023-09-16","lastModifiedDate":"2024-06-26","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/deep-readonly-generic-in-typescript-4b04"},"path":"2023-09-16-deep-readonly-generic-in-typescript.md"},{"metadata":{"name":"Typing Object Keys With Enum Values Using Typescript","series":null,"date":"2023-11-01","lastModifiedDate":"2023-11-01","author":"Volodymyr Yepishev","tags":["typescript","generics","tutorial"],"canonicalLink":"https://dev.to/bwca/typing-object-keys-with-enum-values-using-typescript-4k23"},"path":"2023-11-01-typing-object-keys-with-enum-values-using-typescript.md"},{"metadata":{"name":"How to Create Bookmarklets Using External Libraries like React","series":null,"date":"2024-03-13","lastModifiedDate":"2024-03-13","author":"Volodymyr Yepishev","tags":["javascript","tutorial"],"canonicalLink":"https://dev.to/bwca/how-to-create-bookmarklets-using-libraries-like-react-2bhc"},"path":"2024-03-13-how-to-create-bookmarklets-using-external-libraries-like-react/2024-03-13-how-to-create-bookmarklets-using-external-libraries-like-react.md"},{"metadata":{"name":"Annoying Cat Extension","series":null,"date":"2024-03-29","lastModifiedDate":"2024-03-29","author":"Volodymyr Yepishev","tags":["javascript","tutorial"],"canonicalLink":"https://dev.to/bwca/annoying-cat-extension-4eaf"},"path":"2024-03-29-writing-annoying-image-browser-extension/2024-03-29-writing-annoying-image-browser-extension.md"},{"metadata":{"name":"Improving Dynamic Component Loader Typings in Angular Using Inputs","series":null,"date":"2024-04-15","lastModifiedDate":"2024-04-15","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular","generics"],"canonicalLink":"https://dev.to/bwca/improving-dynamic-component-loader-typings-in-angular-using-inputs-obl"},"path":"2024-04-15-improving-dynamic-component-loader-typings-in-angular-using-inputs/2024-04-15-improving-dynamic-component-loader-typings-in-angular-using-inputs.md"},{"metadata":{"name":"Reducing the Boilerplate for Services Utilizing Subjects in Angular","series":null,"date":"2024-05-06","lastModifiedDate":"2024-05-06","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular","rxjs"],"canonicalLink":"https://dev.to/bwca/reducing-the-boilerplate-for-services-utilizing-subjects-in-angular-44fp"},"path":"2024-05-06-reducing-the-boilerplate-for-stateful-services-in-angular/2024-05-06-reducing-the-boilerplate-for-stateful-services-in-angular.md"},{"metadata":{"name":"Crafting a Global State Hook in React","series":null,"date":"2024-05-18","lastModifiedDate":"2024-05-18","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react","state"],"canonicalLink":"https://dev.to/bwca/crafting-a-global-state-hook-in-react-4hb4"},"path":"2024-05-18-crafting-a-global-state-hook-in-react/2024-05-18-crafting-a-global-state-hook-in-react.md"},{"metadata":{"name":"Abstracting State Management in React with Typescript, and its Benefits","series":null,"date":"2024-06-03","lastModifiedDate":"2024-06-03","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular"],"canonicalLink":"https://dev.to/bwca/abstracting-state-management-in-react-with-typescript-and-its-benefits-8mk"},"path":"2024-06-03-abstracting-state-management-in-react-and-its-benefits/2024-06-03-abstracting-state-management-in-react-and-its-benefits.md"},{"metadata":{"name":"Runtime Environment Config in Angular, but without Dependency Injection","series":null,"date":"2024-06-08","lastModifiedDate":"2024-06-08","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular"],"canonicalLink":"https://dev.to/bwca/runtime-environment-config-in-angular-but-without-dependency-injection-kno"},"path":"2024-06-08-runtime-environment-config-in-angular-but-without-dependency-injection/2024-06-08-runtime-environment-config-in-angular-but-without-dependency-injection.md"},{"metadata":{"name":"Create a Debounce Function from Scratch in Typescript","series":{"name":"Implementing Debounce with Typescript","part":0},"date":"2021-08-26","lastModifiedDate":"2022-04-07","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/create-a-debounce-function-from-scratch-in-typescript-560m"},"path":"create-a-debounce-function-from-scratch-in-typescript/2021-08-26-part-0-create-a-debounce-function-from-scratch-in-typescript.md"},{"metadata":{"name":"Polish Types for the New Debounce Function","series":{"name":"Implementing Debounce with Typescript","part":1},"date":"2022-04-06","lastModifiedDate":"2022-04-06","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/polish-types-for-the-new-debounce-function-5e0n"},"path":"create-a-debounce-function-from-scratch-in-typescript/2022-04-06-part-1-polish-types-for-the-new-debounce-function.md"},{"metadata":{"name":"Caching Decorator","series":{"name":"Decorator Memoization","part":0},"date":"2022-06-06","lastModifiedDate":"2024-06-26","author":"Volodymyr Yepishev","tags":["typescript","tutorial","decorators"],"canonicalLink":"https://dev.to/bwca/caching-decorator-52e1"},"path":"decorator-memoization/2022-06-06-part-0-caching-decorator.md"},{"metadata":{"name":"Memoize Decorator","series":{"name":"Decorator Memoization","part":1},"date":"2022-07-12","lastModifiedDate":"2022-07-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial","decorators"],"canonicalLink":"https://dev.to/bwca/memoize-decorator-5aoo"},"path":"decorator-memoization/2022-07-12-part-1-memoize-decorator.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 0: Intro","series":{"name":"Implementing React Check Permissions","part":0},"date":"2021-10-29","lastModifiedDate":"2021-10-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-reach-check-permissions-part-0-intro-1inc"},"path":"impementing-react-check-permission/2021-10-29-part-0-intro.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 1: Check Permissions Function","series":{"name":"Implementing React Check Permissions","part":1},"date":"2021-10-30","lastModifiedDate":"2021-10-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-reach-check-permissions-part-1-check-permissions-function-136l"},"path":"impementing-react-check-permission/2021-10-30-part-1-check-permissions-function.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 2: Check Permissions Hook","series":{"name":"Implementing React Check Permissions","part":2},"date":"2021-11-01","lastModifiedDate":"2021-11-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-react-check-permissions-the-hook-3m20"},"path":"impementing-react-check-permission/2021-11-01-part-2-use-check-permissions.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 3: with Permissions Component","series":{"name":"Implementing React Check Permissions","part":3},"date":"2021-11-04","lastModifiedDate":"2021-11-04","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-react-check-permissions-the-component-3gjm"},"path":"impementing-react-check-permission/2021-11-04-part-3-with-permissions-component.md"},{"metadata":{"name":"Iframe Microfrontends: Intro and Setup","series":{"name":"Iframe Microfrontends","part":0},"date":"2022-05-30","lastModifiedDate":"2022-05-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-intro-and-setup-1g7h"},"path":"implement-iframe-microfrontend/2022-05-30-part-0-intro-and-setup.md"},{"metadata":{"name":"Iframe Microfrontends: Standalone React Application","series":{"name":"Iframe Microfrontends","part":1},"date":"2022-05-31","lastModifiedDate":"2022-05-31","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-standalone-react-application-341f"},"path":"implement-iframe-microfrontend/2022-05-31-part-1-standalone-react-application.md"},{"metadata":{"name":"Iframe Microfrontends: Angular Shell","series":{"name":"Iframe Microfrontends","part":2},"date":"2022-05-31","lastModifiedDate":"2022-05-31","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-angular-shell-pmj"},"path":"implement-iframe-microfrontend/2022-05-31-part-2-angular-shell-application.md"},{"metadata":{"name":"Iframe Microfrontends: Make React App Proper Iframe","series":{"name":"Iframe Microfrontends","part":3},"date":"2022-06-01","lastModifiedDate":"2022-06-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-make-react-app-proper-iframe-12g9"},"path":"implement-iframe-microfrontend/2022-06-01-part-3-make-react-app-proper-iframe.md"},{"metadata":{"name":"Create Singleton with ES2022","series":{"name":"Singleton","part":1},"date":"2022-06-25","lastModifiedDate":"2022-07-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","javascript"],"canonicalLink":"https://dev.to/bwca/create-singleton-with-es2022-51ic"},"path":"singleton/2022-06-25-part-1-create-singleton-with-es2022.md"},{"metadata":{"name":"Singleton Decorator","series":{"name":"Singleton","part":0},"date":"2022-07-01","lastModifiedDate":"2022-07-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/singleton-decorator-526h"},"path":"singleton/2022-07-01-part-0-singleton-decorator.md"}],"h":{},"s":200,"st":"OK","u":"./articles/index.json","rt":"json"},"4246624708":{"b":"```ic-metadata\r\n{\r\n  \"name\": \"Annoying Cat Extension\",\r\n  \"series\": null,\r\n  \"date\": \"2024-03-29\",\r\n  \"lastModifiedDate\": \"2024-03-29\",\r\n  \"author\": \"Volodymyr Yepishev\",\r\n  \"tags\": [\"javascript\", \"tutorial\"],\r\n  \"canonicalLink\": \"https://dev.to/bwca/annoying-cat-extension-4eaf\"\r\n}\r\n```\r\n\r\n# Annoying Cat Extension\r\n\r\n_The link to the full code for this article is at the end of this article._\r\n\r\nOnce upon a time I was involved in adding an Easter egg to an application that once a year, on April 1, would cause a famous doge meme to slide out from the left side of the screen. When hovered over, the doge would hide, to come back after some time. It was hidden from serious people in production by a boolean flag, but the development team loved it.\r\n\r\nSo recently I thought why not create a bookmarklet or extension to get similar experience anywhere, any time? In the end I decided to go with browser extension, since packing an image as base64 into a bookmarklet makes it too big to be used as a bookmarklet and would only work when pasted into browser's console, I also decided I would want to make it more flexible this time, with the image sliding from random side of the screen, left, right, top or bottom.\r\n\r\nNow, I do not have a doge meme dog to take a picture of, but I still have a picture of my cat peeping out of a box, which looks perfect for this type of thing, though the approach I intend to use during the implementation will not rely on the image dimensions, so any picture would do really.\r\n\r\n![annoying-cat.png](articles/2024-03-29-writing-annoying-image-browser-extension/..%2F..%2Fbrowser-extension_annoying-cat%2Fassets%2Fannoying-cat.png)\r\n\r\nBeing a developer, removing the background on the image was the hardest part, but I digress.\r\n\r\nFirst we create a folder for the extension and add the assets folder and the image to it, i.e. in `assets/annoying-cat.png`. Having a folder is not necessary, but it keeps things neat and tidy. Also, storing the image as a file compared to base64 string in the javascript file is also less messy when it comes to reading the code.\r\n\r\nThe next step is to add `manifest.json`, which should have `web_accessible_resources` section to allow using the image from assets:\r\n\r\n```json\r\n{\r\n  \"manifest_version\": 3,\r\n  \"name\": \"Annoying Cat\",\r\n  \"version\": \"1.0\",\r\n  \"description\": \"Annoys you.\",\r\n  \"permissions\": [\r\n    \"activeTab\"\r\n  ],\r\n  \"content_scripts\": [\r\n    {\r\n      \"matches\": [\"\u003Call_urls>\"],\r\n      \"js\": [\"content.js\"]\r\n    }\r\n  ],\r\n  \"web_accessible_resources\": [\r\n    {\r\n      \"resources\": [\"assets/annoying-cat.png\"],\r\n      \"matches\": [\"\u003Call_urls>\"]\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nI don't create browser extensions too often, so I had to look it up, as I originally went with relative image path and failed miserably.\r\n\r\nNow for `content.js`, I decided not to just pile all the code there, but put it inside an IIFE in case I ever want to extract it for a bookmarklet or to paste it into console. As a tribute to ~~real~~ other programming languages, I decided to call it main:\r\n\r\n```javascript\r\n(function main() {\r\n    /** here be annoying cat */\r\n})()\r\n```\r\n\r\nFirst of all, let us add some basic stuff, like enumeration to determine direction from which the image is going to appear as well as the css classes we use to manipulate it:\r\n\r\n```javascript\r\nconst DIRECTIONS = {\r\n    TOP: 3,\r\n    RIGHT: 1,\r\n    BOTTOM: 2,\r\n    LEFT: 4,\r\n};\r\n\r\nconst CSS_CLASSES = {\r\n    IMAGE: 'annoying-cat-image',\r\n    SHOW: 'annoying-cat-image-show',\r\n    HIDE: 'annoying-cat-image-hide',\r\n};\r\n```\r\n\r\nTo utilize those classes, we need to create them and attach to the document's head. Let's make the image positioned fixed, with ridiculous z-index and outside the viewport initially, with some transitions for sliding out and hiding (this will happen when the image receives mouse over event).\r\n\r\n```javascript\r\nfunction addStyles() {\r\n    const style = document.createElement('style');\r\n    style.innerHTML = `\r\n    .${CSS_CLASSES.IMAGE} {\r\n        position: fixed;\r\n        left: -100vw;\r\n        top: -100vh;\r\n        z-index: ${Number.MAX_SAFE_INTEGER}\r\n    }\r\n    \r\n    .${CSS_CLASSES.HIDE} {\r\n        transition-property: top, bottom, left, right;\r\n        transition-duration: 0.2s;\r\n        transition-timing-function: ease-out;\r\n    }\r\n    \r\n    .${CSS_CLASSES.SHOW} {\r\n        transition-property: top, bottom, left, right;\r\n        transition-duration: 1s;\r\n        transition-timing-function: ease-out;\r\n    }`;\r\n    \r\n    document.head.appendChild(style);\r\n}\r\n```\r\n\r\nCreating the image itself and adding source to it can be done using a couple of functions, I like to separate setting the source, because it might be URL or base64, which makes it easier to change if it is a separate function:\r\n\r\n```javascript\r\nfunction createImage() {\r\n    const el = document.createElement('img');\r\n    el.src = getImageSource();\r\n    el.classList.add(CSS_CLASSES.IMAGE);\r\n    document.body.appendChild(el);\r\n    return el;\r\n}\r\n\r\nfunction getImageSource() {\r\n    return chrome.runtime.getURL('assets/annoying-cat.png');\r\n}\r\n```\r\n\r\nAs we do not want to have the image sliding out from the same spots, we need a function to get random numbers, so we can get the random side, and the left offset if it is top/bottom or top offset if it is left/right. This means our function would have to be able to generate a random number between two given values:\r\n\r\n```javascript\r\nfunction getRandomNumber(max, min = 1) {\r\n    const minCeiled = Math.ceil(min);\r\n    const maxFloored = Math.floor(max);\r\n    return Math.floor(Math.random() * (maxFloored - minCeiled + 1) + minCeiled);\r\n}\r\n```\r\n\r\nHaving this function we can create a function that generates a random direction, since our directions are a range from 1-4, we need a random number in that range:\r\n\r\n```javascript\r\nfunction getDirection() {\r\n    return getRandomNumber(4);\r\n}\r\n```\r\n\r\nNow, for an interesting part: since we do not want to rely on hard-coding width/height of the image, but calculating them on the fly, we cannot completely hide it, or those values would be 0, we would have to set the image's visibility to hidden instead. Moreover, since the image is going to appear from a random side and position, it means we would have to reposition it before changing its visibility to visible and allowing its appearance via css classes with transitions. This means the invisible image will be flying through the screen at some point.\r\n\r\nIn order to avoid awkward situation with flying image becoming visible before we want it to, let us delegate this event to a function, which would add the show class to the image, adjust its visibility and perform a callback to set its other properties, which will vary, depending on the side of the screen, from which the image appears:\r\n\r\n```javascript\r\nfunction show(slideCb) {\r\n    setTimeout(() => {\r\n        img.classList.add(CSS_CLASSES.SHOW);\r\n        img.style.visibility = 'visible';\r\n        slideCb();\r\n    }, 1000);\r\n}\r\n```\r\n\r\nTo handle all 4 cases for each screen side, we can add 4 function to handle each case (could probably be reduced to 1), they are rather similar in structure, they reposition the image and set properties for it to slide out ~~annoyingly~~.\r\n\r\nThe pattern is the following: we position the image behind the side, from which it is supposed to emerge, rotating it accordingly, get random position for its left or top offset and showing it with a delay. Note the usage of `window.getComputedStyle` to dynamically obtain its width and height.\r\n\r\n```javascript\r\nfunction slideFromTop(img) {\r\n    img.style.visibility = 'hidden';\r\n    img.style.transformOrigin = 'unset';\r\n    img.style.top = -1 * window.getComputedStyle(img).height.replace('px', '') + 'px';\r\n    img.style.left = getRandomNumber(window.innerWidth - window.getComputedStyle(img).width.replace('px', '')) + 'px';\r\n    img.style.transform = 'scaleY(-1)';\r\n    show(() => {\r\n        img.style.top = '0';\r\n    });\r\n}\r\n\r\nfunction slideFromBottom(img) {\r\n    img.style.visibility = 'hidden';\r\n    img.style.transformOrigin = 'unset';\r\n    img.style.top = 'unset';\r\n    img.style.left = getRandomNumber(window.innerWidth - window.getComputedStyle(img).width.replace('px', '')) + 'px';\r\n    img.style.transform = 'scaleY(1)';\r\n    img.style.bottom = -1 * window.getComputedStyle(img).height.replace('px', '') + 'px';\r\n    show(() => {\r\n        img.style.bottom = '0';\r\n    });\r\n}\r\n\r\nfunction slideFromLeft(img) {\r\n    img.style.visibility = 'hidden';\r\n    img.style.transformOrigin = 'left top';\r\n    img.style.top = getRandomNumber(window.innerHeight - window.getComputedStyle(img).width.replace('px', '')) + 'px';\r\n    img.style.transform = 'rotate(90deg)';\r\n    img.style.left = -1 * window.getComputedStyle(img).height.replace('px', '') + 'px';\r\n    show(() => {\r\n        img.style.left = window.getComputedStyle(img).height;\r\n    });\r\n}\r\n\r\nfunction slideFromRight(img) {\r\n    img.style.visibility = 'hidden';\r\n    img.style.transformOrigin = 'right top';\r\n    img.style.top = getRandomNumber(window.innerHeight - window.getComputedStyle(img).width.replace('px', '')) + 'px';\r\n    img.style.left = 'unset';\r\n    img.style.transform = 'rotate(-90deg)';\r\n    img.style.right = -1 * window.getComputedStyle(img).height.replace('px', '') + 'px';\r\n    show(() => {\r\n        img.style.right = window.getComputedStyle(img).height;\r\n    });\r\n}\r\n```\r\n\r\nWith these handlers ready, it is time to write a function that would call the appropriate handler, for the given direction:\r\n\r\n```javascript\r\nfunction slideOut(img, dir) {\r\n    img.classList.remove(CSS_CLASSES.HIDE);\r\n    img.classList.add(CSS_CLASSES.SHOW);\r\n    if (dir === DIRECTIONS.TOP) {\r\n        slideFromTop(img);\r\n    } else if (dir === DIRECTIONS.BOTTOM) {\r\n        slideFromBottom(img);\r\n    } else if (dir === DIRECTIONS.LEFT) {\r\n        slideFromLeft(img);\r\n    } else if (dir === DIRECTIONS.RIGHT) {\r\n        slideFromRight(img);\r\n    }\r\n}\r\n```\r\n\r\nShowing image is only a part of our intention, we also need a function to reset it back to hiding, with a fast transition:\r\n\r\n```javascript\r\nfunction reset(img, dir) {\r\n    img.classList.remove(CSS_CLASSES.SHOW);\r\n    img.classList.add(CSS_CLASSES.HIDE);\r\n    const offset =\r\n      -1 * window.getComputedStyle(img).height.replace(\"px\", \"\") + \"px\";\r\n    if (dir === DIRECTIONS.TOP) {\r\n      img.style.top = offset;\r\n    } else if (dir === DIRECTIONS.BOTTOM) {\r\n      img.style.bottom = offset;\r\n    } else if (dir === DIRECTIONS.LEFT) {\r\n      img.style.left = offset;\r\n    } else if (dir === DIRECTIONS.RIGHT) {\r\n      img.style.right = offset;\r\n    }\r\n}\r\n```\r\n\r\nThe function to make image slide out from random direction can be crafted using a factory, which accepts the image itself and a cooldown timer:\r\n\r\n```javascript\r\nfunction createSlideOutFunction(img, showUpCoolDown) {\r\n    let slideDirection;\r\n    \r\n    return () => {\r\n        reset(img, slideDirection);\r\n        setTimeout(() => {\r\n            slideDirection = getDirection();\r\n            slideOut(img, slideDirection);\r\n        }, showUpCoolDown);\r\n    };\r\n}\r\n```\r\n\r\nWith all needed functions in place, all that is left is to evoke them in a proper sequence:\r\n\r\n```javascript\r\n  addStyles();\r\n\r\n  const img = createImage();\r\n  // annoy every 2 seconds\r\n  const showUpCoolDown = 2 * 1000;\r\n  const slideOutRandomly = createSlideOutFunction(img, showUpCoolDown);\r\n  img.addEventListener(\"mouseenter\", slideOutRandomly);\r\n  slideOutRandomly();\r\n```\r\n\r\nNow the unpacked extension can be loaded in chrome :)\r\n\r\nThe source code is available on [github](https://github.com/Bwca/browser-extension_annoying-cat).","h":{},"s":200,"st":"OK","u":"./articles/2024-03-29-writing-annoying-image-browser-extension/2024-03-29-writing-annoying-image-browser-extension.md","rt":"text"},"__nghData__":[{},{"t":{"1":"t0"},"c":{"1":[{"i":"t0","r":3,"t":{"0":"t1","1":"t2"},"c":{"0":[],"1":[{"i":"t2","r":1}]},"x":2}]}},{"e":{"1":4},"t":{"2":"t4","3":"t5"},"c":{"2":[{"i":"t4","r":2,"e":{"0":1}}],"3":[]}},{"t":{"3":"t6"},"c":{"3":[]}},{"c":{"0":[]}},{"t":{"0":"t3","6":"t7"},"c":{"0":[{"i":"t3","r":1}],"6":[]},"n":{"3":"2f2"},"d":[5]},{"c":{"6":[{"i":"c1870341192","r":1}]}}]}</script></body></html>