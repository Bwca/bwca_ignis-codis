<!DOCTYPE html><html lang="en-CA" dir="ltr" data-critters-container><head>
    <meta charset="utf-8">
    <title>Ignis Codis :  Runtime Environment Config in Angular, but without Dependency Injection</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="logo.png">
  <style>:root{--theme-dark: #1e2019;--theme-dark-secondary: #393e41;--theme-light: #d3d0cb;--theme-accent: #e2c044;--theme-tertiary: #587b7f}button{transition:all .3s;color:var(--theme-accent)}button:hover,button:focus{background-color:var(--theme-accent);color:var(--theme-dark)}button{background-color:var(--theme-dark);border:1px solid var(--theme-accent);padding:.2rem 1rem;font-variant:small-caps;font-size:.9rem}body{font-size:1rem}h1{font-size:2.5rem}button{cursor:pointer}html{font-family:sans-serif,monospace}@media only screen and (max-width: 600px){html{font-size:16px}}@media only screen and (min-width: 600px){html{font-size:18px}}body{background-color:var(--theme-dark);color:var(--theme-light);padding:0;margin:0}*{transform:translateZ(0)}a{color:var(--theme-accent)}a:hover,a:focus{text-decoration:none;background-color:var(--theme-accent);color:var(--theme-dark)}markdown .language-ic-metadata{display:none}code[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}
</style><link rel="stylesheet" href="styles-4SQKIKAV.css" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles-4SQKIKAV.css"></noscript><style ng-app-id="ng">[_nghost-ng-c3775897885]{display:grid;height:100vh;overflow:hidden;box-sizing:border-box;width:auto;position:relative}@media only screen and (max-width: 600px){[_nghost-ng-c3775897885]{background:linear-gradient(to bottom,var(--theme-dark-secondary),var(--theme-dark) 80px 100%);padding:5px 0 0;grid-template-columns:1fr 1fr;grid-template-rows:auto 1fr auto;grid-template-areas:"logo social" "content content" "nav nav"}[_nghost-ng-c3775897885]   [data-ic-logo][_ngcontent-ng-c3775897885]{margin-left:30px}[_nghost-ng-c3775897885]   [data-ic-social-buttons][_ngcontent-ng-c3775897885]{justify-self:flex-end;margin-right:30px}[_nghost-ng-c3775897885]   main[_ngcontent-ng-c3775897885]{border-width:1px 0 0 0;border-style:solid;padding:10px;border-color:var(--theme-tertiary)}}@media only screen and (min-width: 600px){[_nghost-ng-c3775897885]{background:linear-gradient(to right,var(--theme-dark-secondary),var(--theme-dark) 125px 100%);padding:30px 0 30px 5px;grid-template-columns:100px 1fr;grid-template-rows:auto auto 1fr;grid-gap:20px;grid-template-areas:"logo content" "nav  content" "social content"}[_nghost-ng-c3775897885]   [data-ic-social-buttons][_ngcontent-ng-c3775897885]{justify-self:flex-start;align-self:flex-start}[_nghost-ng-c3775897885]   main[_ngcontent-ng-c3775897885]{border-width:0 0 0 1px;border-style:solid;border-color:var(--theme-tertiary)}}[data-ic-logo][_ngcontent-ng-c3775897885]{grid-area:logo}[data-ic-social-buttons][_ngcontent-ng-c3775897885]{grid-area:social;align-self:center}[data-ic-navigation][_ngcontent-ng-c3775897885]{grid-area:nav}main[_ngcontent-ng-c3775897885]{grid-area:content}main[_ngcontent-ng-c3775897885]   section[_ngcontent-ng-c3775897885]{max-width:800px}main[_ngcontent-ng-c3775897885]{overflow:auto;box-sizing:border-box;padding:30px;scrollbar-width:thin;scrollbar-color:var(--theme-light) var(--theme-tertiary)}</style><style ng-app-id="ng">[_nghost-ng-c1712305223]{display:flex}a[_ngcontent-ng-c1712305223]{display:block}a[_ngcontent-ng-c1712305223]:hover, a[_ngcontent-ng-c1712305223]:focus{background-color:transparent}img[_ngcontent-ng-c1712305223]{display:block;width:100%}@media only screen and (max-width: 600px){img[_ngcontent-ng-c1712305223]{max-width:55px}}@media only screen and (min-width: 600px){img[_ngcontent-ng-c1712305223]{max-width:150px}}</style><style ng-app-id="ng">a[_ngcontent-ng-c3947245871]{transition:all .3s;color:var(--theme-accent)}a[_ngcontent-ng-c3947245871]   [data-ic-icon][_ngcontent-ng-c3947245871]{--background-color: var(--theme-accent);padding:0}a[_ngcontent-ng-c3947245871]:hover, a[_ngcontent-ng-c3947245871]:focus{background-color:var(--theme-accent);color:var(--theme-dark)}a[_ngcontent-ng-c3947245871]:hover   [data-ic-icon][_ngcontent-ng-c3947245871], a[_ngcontent-ng-c3947245871]:focus   [data-ic-icon][_ngcontent-ng-c3947245871]{--background-color: var(--theme-dark)}a.active[_ngcontent-ng-c3947245871]{background-color:var(--theme-dark-secondary);cursor:unset;color:var(--theme-light)}a.active[_ngcontent-ng-c3947245871]   [data-ic-icon][_ngcontent-ng-c3947245871]{--background-color: var(--theme-light)}[_nghost-ng-c3947245871]{display:flex;align-items:center;justify-content:flex-end;width:100%}@media only screen and (min-width: 600px){[_nghost-ng-c3947245871]{justify-content:space-evenly}}a[_ngcontent-ng-c3947245871]{transition:all .3s;display:flex;border-radius:5px}a[_ngcontent-ng-c3947245871]{margin:10px}[data-ic-icon][_ngcontent-ng-c3947245871]{--font-size: 1.5rem}</style><style ng-app-id="ng">a[_ngcontent-ng-c632272801]{transition:all .3s;color:var(--theme-accent)}a[_ngcontent-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{--background-color: var(--theme-accent);padding:0}a[_ngcontent-ng-c632272801]:hover, a[_ngcontent-ng-c632272801]:focus{background-color:var(--theme-accent);color:var(--theme-dark)}a[_ngcontent-ng-c632272801]:hover   [data-ic-icon][_ngcontent-ng-c632272801], a[_ngcontent-ng-c632272801]:focus   [data-ic-icon][_ngcontent-ng-c632272801]{--background-color: var(--theme-dark)}a.active[_ngcontent-ng-c632272801]{background-color:var(--theme-dark-secondary);cursor:unset;color:var(--theme-light)}a.active[_ngcontent-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{--background-color: var(--theme-light)}[_nghost-ng-c632272801]{display:flex}@media only screen and (max-width: 600px){[_nghost-ng-c632272801]{flex-direction:row}[_nghost-ng-c632272801]   a[_ngcontent-ng-c632272801]{text-align:center;flex-grow:1}[_nghost-ng-c632272801]   .title[_ngcontent-ng-c632272801]{display:none}[_nghost-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{--font-size: 1.2rem}}@media only screen and (min-width: 600px){[_nghost-ng-c632272801]{flex-direction:column}[_nghost-ng-c632272801]   a[_ngcontent-ng-c632272801]{text-align:left}[_nghost-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{display:none}}a[_ngcontent-ng-c632272801]{background-color:var(--theme-dark);display:block;border:1px solid var(--theme-tertiary);box-sizing:border-box;padding:5px 15px;cursor:pointer;transition:all .3s;font-variant:small-caps;font-size:.9rem;text-decoration:none}</style><style ng-app-id="ng">[_nghost-ng-c1206199484]{--background-color: var(--theme-accent);--font-size: 1rem;display:contents}span[_ngcontent-ng-c1206199484]{background-color:var(--background-color);width:var(--font-size);height:var(--font-size)}a[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484]{background-color:var(--background-color)}a:hover[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a:hover   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a:active[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a:active   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484]{background-color:var(--background-color)}a.active[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a.active   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484]{background-color:var(--background-color)}</style><style ng-app-id="ng">.details[_ngcontent-ng-c1870341192]{margin-top:20px;font-size:.7rem;scrollbar-width:thin}.details[_ngcontent-ng-c1870341192]   .summary[_ngcontent-ng-c1870341192]{cursor:pointer;font-variant:small-caps}.article-metadata[_ngcontent-ng-c1870341192]{display:flex;flex-direction:column;justify-content:space-between;align-items:flex-start;flex-wrap:wrap}.article-metadata[_ngcontent-ng-c1870341192] > *[_ngcontent-ng-c1870341192]{padding:10px 0 0}@media only screen and (min-width: 600px){.article-metadata[_ngcontent-ng-c1870341192]{flex-direction:row}}</style><link rel="https://dev.to/bwca/runtime-environment-config-in-angular-but-without-dependency-injection-kno"></head>
  <body><!--nghm-->
    <div data-ic-root _nghost-ng-c3775897885 class="ng-tns-c3775897885-0" ng-version="18.0.3" ngh="6" ng-server-context="ssg"><header _ngcontent-ng-c3775897885 data-ic-logo class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromTop" _nghost-ng-c1712305223 ngh="0"><a _ngcontent-ng-c1712305223 href="/home"><img _ngcontent-ng-c1712305223 src="./logo.png" alt="logo, depicting a ginger cat in a box"></a></header><nav _ngcontent-ng-c3775897885 data-ic-social-buttons class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromBottom" _nghost-ng-c3947245871 ngh="0"><a _ngcontent-ng-c3947245871 target="_blank" href="https://github.com/Bwca" title="GitHub"><span _ngcontent-ng-c3947245871 data-ic-icon iconname="github" _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/github.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span></a><a _ngcontent-ng-c3947245871 target="_blank" href="https://www.linkedin.com/in/volodymyr-yepishev" title="LinkedIn"><span _ngcontent-ng-c3947245871 data-ic-icon iconname="linkedin" _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/linkedin.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span></a></nav><nav _ngcontent-ng-c3775897885 data-ic-navigation class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromLeft" _nghost-ng-c632272801 ngh="1"><!----><a _ngcontent-ng-c632272801 routerlinkactive="active" title="home" href="/home" class="ng-star-inserted" style><span _ngcontent-ng-c632272801 data-ic-icon _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/home.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span><span _ngcontent-ng-c632272801 class="title">home</span></a><!----><!----><a _ngcontent-ng-c632272801 routerlinkactive="active" title="articles" href="/dev-articles" class="ng-star-inserted" style><span _ngcontent-ng-c632272801 data-ic-icon _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/book.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span><span _ngcontent-ng-c632272801 class="title">articles</span></a><!----><!----></nav><main _ngcontent-ng-c3775897885 class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromRight"><section _ngcontent-ng-c3775897885 class="ng-tns-c3775897885-0 ng-trigger ng-trigger-routeAnimations"><router-outlet _ngcontent-ng-c3775897885 class="ng-tns-c3775897885-0"></router-outlet><div _nghost-ng-c1870341192 data-ic-article-view class="ng-star-inserted" style ngh="5"><div _ngcontent-ng-c1870341192 data-ic-breadcrumbs _nghost-ng-c1373225446 class="ng-star-inserted" ngh="2"><div _ngcontent-ng-c1373225446><span _ngcontent-ng-c1373225446 class="ng-star-inserted"> / <a _ngcontent-ng-c1373225446 href="/dev-articles">Articles</a> /  Runtime Environment Config in Angular, but without Dependency Injection </span><!----><!----><!----><!----></div></div><!----><section _ngcontent-ng-c1870341192 class="article-metadata"><section _ngcontent-ng-c1870341192 data-ic-accordion class="details ng-tns-c2942593920-1 ng-star-inserted" _nghost-ng-c2942593920 ngh="3"><button _ngcontent-ng-c2942593920 class="ng-tns-c2942593920-1"><span _ngcontent-ng-c1870341192 ngprojectas="summary" class="summary ng-tns-c2942593920-1">article metadata</span></button><br _ngcontent-ng-c2942593920 class="ng-tns-c2942593920-1"><!----></section><!----></section><section _ngcontent-ng-c1870341192 data-ic-markdown _nghost-ng-c1847889374 ngh="4"><markdown _ngcontent-ng-c1847889374 clipboard ngh="0"><pre><code class="language-ic-metadata">{
  "name": "Runtime Environment Config in Angular, but without Dependency Injection",
  "series": null,
  "date": "2024-06-08",
  "lastModifiedDate": "2024-06-08",
  "author": "Volodymyr Yepishev",
  "tags": ["typescript", "tutorial", "angular"],
  "canonicalLink": "https://dev.to/bwca/runtime-environment-config-in-angular-but-without-dependency-injection-kno"
}
</code></pre>
<h1>Runtime Environment Config in Angular, but without Dependency Injection</h1>
<p>Cover image by Nightcafe, because Gemeni refuses to make images :/</p>
<p>The link to the repo for the code used in the article is provided at the end.</p>
<p>Configuring Angular to use environment variables packed in a json file, which is later pulled and provided by a dedicated service is a topic covered by several articles found on web. Yet, this approach sets a certain restriction on how the environment is provided, so it is no longer a ts import, but rather something provided inside Angular dependency injection system.</p>
<p>In this article we will take a look how to rewire Angular to use a json environment file, but without a separate service to provide it, in fact we are going to explore a way to preserve the environment.ts files for the dev experience. In the end we will be looking at environment.ts, which is transformed into environment.json, so the familiar way of using env files is preserved, at the same time new benefits of having a runtime configuration file is added. Which means migrating to the json file would not trigger any changes in the consuming components, which can be quite convenient if environment is used in many places.</p>
<p>Let us consider we have a typed environment, which has the following model, nesting is for demo purposes, to make it look more complicated:</p>
<pre><code class="language-typescript">// src/environments/models/environment.model.ts
export interface Environment {
    api: string;
    something: {
        completely: {
            different: string;
        };
    };
}
</code></pre>
<p>And there is a consuming component that merely displays some values:</p>
<pre><code class="language-typescript">// src/app/app.component.ts
import { Component } from '@angular/core';

import { environment } from '../environments/environment';

@Component({
    selector: 'app-root',
    standalone: true,
    template: `&lt;p&gt;
        Api: {{ environment.api }}
        &lt;br /&gt;
        And now for something completely different:
        {{ environment.something.completely.different }}
    &lt;/p&gt;`,
})
export class AppComponent {
    protected readonly environment = environment;
}
</code></pre>
<p>Let us add an extra environment <code>environment.development.ts</code>, which is going to be a copy of <code>environment.ts</code>. We will be utilizing it for development, while <code>environment.ts</code> will be to preserve the imports.</p>
<p>This is our starting point, now we need to rewire the application to use environment configuration from a json file instead with minimal changes to <code>src/app</code> and no changes to <code>AppComponent</code>.</p>
<p>The first things that needs to be done is converting the environment typescript file into json. We could leverage <code>npx</code> and <code>ts-node</code> with some edgy inline magic to achieve that. Consider adding the following command to the scripts in <code>package.json</code> (I am using Windows, the amount of backslashes could different on a better OS):</p>
<pre><code class="language-json">"generate-env": "npx ts-node -O \"{\\\"module\\\":\\\"commonjs\\\"}\" -e \"const fs = require('fs'); const path = require('path'); const { environment } = require(path.join(process.cwd(), './src/environments/', (process.argv[1] || 'environment.development.ts'))); fs.writeFileSync(path.join(process.cwd(), './src/assets/environment.json'), JSON.stringify(environment));\""
</code></pre>
<p>Looks like a screenshot from war crimes in programming youtube video, I know. Essentially it is an inlined javascript snippet, here is how it looks formatted:</p>
<pre><code class="language-javascript">const fs = require('fs'); 
const path = require('path'); 

const { environment } = require(
    path.join(process.cwd(), 
        './src/environments/', 
        (process.argv[1] || 'environment.development.ts')
    )
);

fs.writeFileSync(
    path.join(
        process.cwd(), 
        './src/assets/environment.json'
    ), 
    JSON.stringify(environment)
);
</code></pre>
<p>As you can see, nothing special happens, just a given environment file is converted into json and placed inside <code>/src/assets/environment.json</code>. If no environment file name is passed, default to be used is <code>environment.development.ts</code>.</p>
<p>Updating the <code>start</code> and <code>build</code> commands we get the following:</p>
<pre><code class="language-json">"start": "npm run generate-env &amp;&amp; ng serve",
"build": "npm run generate-env -- environment.production.ts &amp;&amp; ng build",
</code></pre>
<p>Now the json environment file is going to be generated every time the app is served in development mode or built for production.</p>
<p>Generated file is not yet used by anything, it has to be loaded in the app first. For the purpose of loading and consequently providing it, we will add a special class, <code>EnvironmentLoader</code>, which will have only static methods and properties. Think of it as a static class.</p>
<pre><code class="language-typescript">// src/environments/utils/environment-loader.util.ts
import { Environment } from '../models/environment.model';

export class EnvironmentLoader {
    private static env: Environment;

    public static get environment(): Environment {
        return EnvironmentLoader.env;
    }

    public static async loadEnvironment(): Promise&lt;void&gt; {
        const response = await fetch('/assets/environment.json');
        try {
            EnvironmentLoader.env = await response.json();
        } catch (e) {
            console.log('Could not load config, oh no!');
        }
    }
}
</code></pre>
<p>It uses fetch, so it is independent of Angular and does not need to depend on <code>HttpClientModule</code>. It has to run before the application is fully bootstrapped, so we have to use the <code>APP_INITIALIZER</code> token and create a provider for it:</p>
<pre><code class="language-typescript">// src/environments/providers/provide-environment.provider.ts
import { APP_INITIALIZER, Provider } from '@angular/core';

import { EnvironmentLoader } from '../utils/environment-loader.util';

export const providerEnvironment: () =&gt; Provider = () =&gt; ({
    provide: APP_INITIALIZER,
    useFactory: () =&gt; () =&gt; EnvironmentLoader.loadEnvironment(),
    multi: true,
});
</code></pre>
<p>With the provider in place, it is time to plug it into the application config:</p>
<pre><code class="language-typescript">// src/app/app.config.ts
import { ApplicationConfig } from '@angular/core';

import { providerEnvironment } from '../environments/providers/provide-environment.provider';

export const appConfig: ApplicationConfig = {
    providers: [providerEnvironment()],
};
</code></pre>
<p>So far so good. We have the mechanism to create a static json configuration file, we have means to fetch and store it before the application get bootstrapped, now comes the most interesting part: to wire up environment.ts to use the values from the json file without introducing changes to the consumers.</p>
<p>Every time a getter is fired on <code>environment</code> object from <code>environment.ts</code>, it should get its value from the appropriate field of <code>EnvironmentLoader.environment</code>, as those come from the json file. If you are thinking about Proxy, you are on the right path, but plain Proxy would not do as we have an object with several nesting levels. What we need is not just a one Proxy wrapper, but a factory, which could call itself and craft as many proxies on the fly, as we need, every time it encounters an object as a value, when a getter fires.</p>
<pre><code class="language-typescript">// src/environments/utils/create-proxy.util.ts
import { EnvironmentLoader } from './environment-loader.util';

export function createProxy&lt;T extends object&gt;(target: T, path = ''): T {
    return new Proxy(target, {
        get: function (obj, prop: string) {
            const fullPath = path ? `${path}.${prop.toString()}` : prop;

            const value = fullPath
                .split('.')
                .reduce((a, c) =&gt; a[c], EnvironmentLoader.environment as any);

            if (value &amp;&amp; typeof value === 'object') {
                return createProxy(value, fullPath.toString());
            }
            return value;
        },
    });
}
</code></pre>
<p>What is happening over there? Every time a getter fires, we calculate the path to the property and reach out to <code>EnvironmentLoader.environment</code> to get the value, if it is an object, we return another Proxy, passing the path along the way, once we reach the primitive value, we return it. This is how we counter paths like <code>environment.something.completely.different</code>.</p>
<p>This is all the heavy-lifting to be done, the only thing left is to update <code>environment.ts</code> and set it to proxy from our factory:</p>
<pre><code class="language-typescript">// src/environments/environment.ts
import { Environment } from './models/environment.model';
import { createProxy } from './utils/create-proxy.util';

export const environment: Environment = createProxy({} as Environment);
</code></pre>
<p>It is done now, the app is wired to a static configuration json file without any changes to consumers and no extra dependency injection. Just some ts/js magic. Now we can modify configuration after building the app, without having to rebuilt it. Something quite useful when you do not know where you deploy beforehand.</p>
<p>Build once, run anywhere, eh? :)</p>
<p>P.S. the <a href="https://github.com/Bwca/demo_runtime-environment-config-in-angular-but-without-dependency-injection">poc repo</a>.</p>
</markdown><!----></section></div><!----></section></main></div>
  <link rel="modulepreload" href="chunk-76TOWMZK.js"><script src="polyfills-UD7OJCHV.js" type="module"></script><script src="scripts-MI2AUGIN.js" defer></script><script src="main-66OU5UQS.js" type="module"></script>

<script id="ng-state" type="application/json">{"341425767":{"b":[{"metadata":{"name":"Create a Custom eslint Rule with Typescript","series":null,"date":"2021-04-02","lastModifiedDate":"2021-07-11","author":"Volodymyr Yepishev","tags":["typescript","tutorial","eslint","npm"],"canonicalLink":"https://dev.to/bwca/create-a-custom-eslint-rule-with-typescript-4j3d"},"path":"2021-04-02-create-a-custom-eslint-rule-with-typescript.md"},{"metadata":{"name":"Create Object Property String Path Generator with Typescript","series":null,"date":"2021-04-13","lastModifiedDate":"2021-04-13","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular","react"],"canonicalLink":"https://dev.to/bwca/create-object-property-string-path-generator-with-typescript-13e3"},"path":"2021-04-13-create-object-property-string-path-generator-with-typescript/2021-04-13-create-object-property-string-path-generator-with-typescript.md"},{"metadata":{"name":"Build Entity-Friendly react-router Paths Generator with Typescript","series":null,"date":"2021-05-12","lastModifiedDate":"2021-05-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/build-entity-friendly-react-router-paths-generator-with-typescript-fpd"},"path":"2021-05-12-build-entity-friendly-react-router-path-generator-with-typescript.md"},{"metadata":{"name":"Split Collection Based on Enum Value with Typescript","series":null,"date":"2021-06-28","lastModifiedDate":"2021-06-28","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/split-collection-based-on-enum-value-with-typescript-4g3b"},"path":"2021-06-28-split-collection-based-on-enum-values/2021-06-28-split-collection-based-on-enum-values.md"},{"metadata":{"name":"Make Your Own Linkedin Promoted Posts Blocker","series":null,"date":"2021-07-14","lastModifiedDate":"2021-07-14","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/make-your-own-linkedin-promoted-posts-blocker-fj5"},"path":"2021-07-14-make-you-own-linkedin-promoted-posts-blocker.md"},{"metadata":{"name":"How I Decided to Write React cli and How it Went","series":null,"date":"2021-08-08","lastModifiedDate":"2021-08-08","author":"Volodymyr Yepishev","tags":["angular"],"canonicalLink":"https://dev.to/bwca/how-i-decided-to-write-react-cli-and-how-it-went-4f19"},"path":"2021-08-08-how-i-decided-to-write-react-cli-and-how-it-went/2021-08-08-how-i-decided-to-write-react-cli-and-how-it-went.md"},{"metadata":{"name":"Remove Double Imports with Regular Expression","series":null,"date":"2022-03-29","lastModifiedDate":"2022-03-29","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/remove-double-imports-with-regular-expression-47af"},"path":"2022-03-29-remove-double-imports-with-regular-expression.md"},{"metadata":{"name":"Decorating React Hook with Typescript","series":null,"date":"2022-04-12","lastModifiedDate":"2022-04-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/decorating-react-hook-with-typescript-bd9"},"path":"2022-04-12-decorating-react-hook-with-typescript.md"},{"metadata":{"name":"Override Method Return with a Decorator","series":null,"date":"2022-04-22","lastModifiedDate":"2022-04-22","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/override-method-return-with-a-decorator-1bii"},"path":"2022-04-22-change-api-response-with-a-decorator.md"},{"metadata":{"name":"Turn Angular Application into Chrome Extension","series":null,"date":"2022-05-25","lastModifiedDate":"2022-05-25","author":"Volodymyr Yepishev","tags":["angular","tutorial","chrome","extension"],"canonicalLink":"https://dev.to/bwca/turn-angular-application-into-chrome-extension-2mkn"},"path":"2022-05-25-turn-angular-application-into-chrome-extension.md"},{"metadata":{"name":"Typed Dates Conversion with Typescript","series":null,"date":"2022-06-30","lastModifiedDate":"2022-06-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","generics","conversion","date","moment"],"canonicalLink":"https://dev.to/bwca/typed-dates-conversion-with-typescript-49n7"},"path":"2022-06-30-typed-date-conversion-with-typescript.md"},{"metadata":{"name":"Weekday - Date - Month type","series":null,"date":"2022-07-29","lastModifiedDate":"2022-07-29","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/weekday-date-month-type-26j4"},"path":"2022-07-29-week-day-date-month-type.md"},{"metadata":{"name":"An Alternative Way of Creating Enumerations in Typescript","series":null,"date":"2022-08-03","lastModifiedDate":"2022-08-03","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/an-alternative-way-of-creating-enumerations-in-typescript-579k"},"path":"2022-08-03-an-alternative-way-of-creating-enumerations-in-typescript.md"},{"metadata":{"name":"Create a Static Class in Typescript","series":null,"date":"2022-08-12","lastModifiedDate":"2022-08-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/create-a-static-class-in-typescript-5ao1"},"path":"2022-08-12-create-static-class-in-typescript.md"},{"metadata":{"name":"Typescript Class Mixins","series":null,"date":"2022-08-20","lastModifiedDate":"2022-08-20","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/typescript-class-mixins-3hib"},"path":"2022-08-20-typescript-class-mixins.md"},{"metadata":{"name":"Using Classes Inside React's Functional Components","series":null,"date":"2022-08-22","lastModifiedDate":"2022-08-22","author":"Volodymyr Yepishev","tags":["typescript","react","tutorial"],"canonicalLink":"https://dev.to/bwca/using-classes-inside-reacts-functional-components-oj3"},"path":"2022-08-22-using-classes-inside-react-functional-component.md"},{"metadata":{"name":"Debouncing Component Methods in Angular","series":null,"date":"2022-08-29","lastModifiedDate":"2022-08-29","author":"Volodymyr Yepishev","tags":["typescript","angular","tutorial"],"canonicalLink":"https://dev.to/bwca/debouncing-component-methods-in-angular-34im"},"path":"2022-08-29-debouncing-component-methods-in-angular.md"},{"metadata":{"name":"A Trick to Further Breaking Down Angular Components","series":null,"date":"2022-09-02","lastModifiedDate":"2022-09-02","author":"Volodymyr Yepishev","tags":["typescript","angular"],"canonicalLink":"https://dev.to/bwca/a-trick-to-further-breaking-down-angular-components-1i8a"},"path":"2022-09-02-a-trick-to-further-breaking-angular-components.md"},{"metadata":{"name":"Typed Enum Flipping in Typescript","series":null,"date":"2022-11-09","lastModifiedDate":"2022-11-09","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/typed-enum-flipping-in-typescript-2ce9"},"path":"2022-11-09-typed-enum-flipping-in-typescript.md"},{"metadata":{"name":"Typed Filtering with Generics in Typescript","series":null,"date":"2022-12-01","lastModifiedDate":"2022-12-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","generics"],"canonicalLink":"https://dev.to/bwca/typed-filtering-with-generics-in-typescript-204f"},"path":"2022-12-01-typed-filtering-with-generics.md"},{"metadata":{"name":"Template Driving Reactive Form Validation in Angular","series":null,"date":"2023-05-15","lastModifiedDate":"2023-05-15","author":"Volodymyr Yepishev","tags":["angular"],"canonicalLink":"https://dev.to/bwca/template-driving-reactive-form-validation-in-angular-302e"},"path":"2023-05-15-template-driving-reactive-form-validation/2023-05-15-template-driving-reactive-form-validation-in-angular.md"},{"metadata":{"name":"Detect Invalid FormGroup Tree in Angular","series":null,"date":"2023-05-17","lastModifiedDate":"2023-05-17","author":"Volodymyr Yepishev","tags":["angular","debugger"],"canonicalLink":"https://dev.to/bwca/detect-invalid-formgroup-tree-in-angular-1ed"},"path":"2023-05-17-detect-invalid-form-group-tree-in-angular/2023-05-17-detect-invalid-form-group-tree-in-angular.md"},{"metadata":{"name":"Safe Route Param Injection in Angular with a Decorator","series":null,"date":"2023-07-22","lastModifiedDate":"2023-07-28","author":"Volodymyr Yepishev","tags":["angular","tutorial","routing","generics"],"canonicalLink":"https://dev.to/bwca/safe-route-param-injection-in-angular-with-a-decorator-1lk7"},"path":"2023-07-22-safe-route-param-injection-in-angular-with-a-decorator.md"},{"metadata":{"name":"Deep Readonly Generic in Typescript","series":null,"date":"2023-09-16","lastModifiedDate":"2024-06-26","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/deep-readonly-generic-in-typescript-4b04"},"path":"2023-09-16-deep-readonly-generic-in-typescript.md"},{"metadata":{"name":"Typing Object Keys With Enum Values Using Typescript","series":null,"date":"2023-11-01","lastModifiedDate":"2023-11-01","author":"Volodymyr Yepishev","tags":["typescript","generics","tutorial"],"canonicalLink":"https://dev.to/bwca/typing-object-keys-with-enum-values-using-typescript-4k23"},"path":"2023-11-01-typing-object-keys-with-enum-values-using-typescript.md"},{"metadata":{"name":"How to Create Bookmarklets Using External Libraries like React","series":null,"date":"2024-03-13","lastModifiedDate":"2024-03-13","author":"Volodymyr Yepishev","tags":["javascript","tutorial"],"canonicalLink":"https://dev.to/bwca/how-to-create-bookmarklets-using-libraries-like-react-2bhc"},"path":"2024-03-13-how-to-create-bookmarklets-using-external-libraries-like-react/2024-03-13-how-to-create-bookmarklets-using-external-libraries-like-react.md"},{"metadata":{"name":"Annoying Cat Extension","series":null,"date":"2024-03-29","lastModifiedDate":"2024-03-29","author":"Volodymyr Yepishev","tags":["javascript","tutorial"],"canonicalLink":"https://dev.to/bwca/annoying-cat-extension-4eaf"},"path":"2024-03-29-writing-annoying-image-browser-extension/2024-03-29-writing-annoying-image-browser-extension.md"},{"metadata":{"name":"Improving Dynamic Component Loader Typings in Angular Using Inputs","series":null,"date":"2024-04-15","lastModifiedDate":"2024-04-15","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular","generics"],"canonicalLink":"https://dev.to/bwca/improving-dynamic-component-loader-typings-in-angular-using-inputs-obl"},"path":"2024-04-15-improving-dynamic-component-loader-typings-in-angular-using-inputs/2024-04-15-improving-dynamic-component-loader-typings-in-angular-using-inputs.md"},{"metadata":{"name":"Reducing the Boilerplate for Services Utilizing Subjects in Angular","series":null,"date":"2024-05-06","lastModifiedDate":"2024-05-06","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular","rxjs"],"canonicalLink":"https://dev.to/bwca/reducing-the-boilerplate-for-services-utilizing-subjects-in-angular-44fp"},"path":"2024-05-06-reducing-the-boilerplate-for-stateful-services-in-angular/2024-05-06-reducing-the-boilerplate-for-stateful-services-in-angular.md"},{"metadata":{"name":"Crafting a Global State Hook in React","series":null,"date":"2024-05-18","lastModifiedDate":"2024-05-18","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react","state"],"canonicalLink":"https://dev.to/bwca/crafting-a-global-state-hook-in-react-4hb4"},"path":"2024-05-18-crafting-a-global-state-hook-in-react/2024-05-18-crafting-a-global-state-hook-in-react.md"},{"metadata":{"name":"Abstracting State Management in React with Typescript, and its Benefits","series":null,"date":"2024-06-03","lastModifiedDate":"2024-06-03","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular"],"canonicalLink":"https://dev.to/bwca/abstracting-state-management-in-react-with-typescript-and-its-benefits-8mk"},"path":"2024-06-03-abstracting-state-management-in-react-and-its-benefits/2024-06-03-abstracting-state-management-in-react-and-its-benefits.md"},{"metadata":{"name":"Runtime Environment Config in Angular, but without Dependency Injection","series":null,"date":"2024-06-08","lastModifiedDate":"2024-06-08","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular"],"canonicalLink":"https://dev.to/bwca/runtime-environment-config-in-angular-but-without-dependency-injection-kno"},"path":"2024-06-08-runtime-environment-config-in-angular-but-without-dependency-injection/2024-06-08-runtime-environment-config-in-angular-but-without-dependency-injection.md"},{"metadata":{"name":"Create a Debounce Function from Scratch in Typescript","series":{"name":"Implementing Debounce with Typescript","part":0},"date":"2021-08-26","lastModifiedDate":"2022-04-07","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/create-a-debounce-function-from-scratch-in-typescript-560m"},"path":"create-a-debounce-function-from-scratch-in-typescript/2021-08-26-part-0-create-a-debounce-function-from-scratch-in-typescript.md"},{"metadata":{"name":"Polish Types for the New Debounce Function","series":{"name":"Implementing Debounce with Typescript","part":1},"date":"2022-04-06","lastModifiedDate":"2022-04-06","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/polish-types-for-the-new-debounce-function-5e0n"},"path":"create-a-debounce-function-from-scratch-in-typescript/2022-04-06-part-1-polish-types-for-the-new-debounce-function.md"},{"metadata":{"name":"Caching Decorator","series":{"name":"Decorator Memoization","part":0},"date":"2022-06-06","lastModifiedDate":"2024-06-26","author":"Volodymyr Yepishev","tags":["typescript","tutorial","decorators"],"canonicalLink":"https://dev.to/bwca/caching-decorator-52e1"},"path":"decorator-memoization/2022-06-06-part-0-caching-decorator.md"},{"metadata":{"name":"Memoize Decorator","series":{"name":"Decorator Memoization","part":1},"date":"2022-07-12","lastModifiedDate":"2022-07-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial","decorators"],"canonicalLink":"https://dev.to/bwca/memoize-decorator-5aoo"},"path":"decorator-memoization/2022-07-12-part-1-memoize-decorator.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 0: Intro","series":{"name":"Implementing React Check Permissions","part":0},"date":"2021-10-29","lastModifiedDate":"2021-10-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-reach-check-permissions-part-0-intro-1inc"},"path":"impementing-react-check-permission/2021-10-29-part-0-intro.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 1: Check Permissions Function","series":{"name":"Implementing React Check Permissions","part":1},"date":"2021-10-30","lastModifiedDate":"2021-10-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-reach-check-permissions-part-1-check-permissions-function-136l"},"path":"impementing-react-check-permission/2021-10-30-part-1-check-permissions-function.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 2: Check Permissions Hook","series":{"name":"Implementing React Check Permissions","part":2},"date":"2021-11-01","lastModifiedDate":"2021-11-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-react-check-permissions-the-hook-3m20"},"path":"impementing-react-check-permission/2021-11-01-part-2-use-check-permissions.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 3: with Permissions Component","series":{"name":"Implementing React Check Permissions","part":3},"date":"2021-11-04","lastModifiedDate":"2021-11-04","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-react-check-permissions-the-component-3gjm"},"path":"impementing-react-check-permission/2021-11-04-part-3-with-permissions-component.md"},{"metadata":{"name":"Iframe Microfrontends: Intro and Setup","series":{"name":"Iframe Microfrontends","part":0},"date":"2022-05-30","lastModifiedDate":"2022-05-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-intro-and-setup-1g7h"},"path":"implement-iframe-microfrontend/2022-05-30-part-0-intro-and-setup.md"},{"metadata":{"name":"Iframe Microfrontends: Standalone React Application","series":{"name":"Iframe Microfrontends","part":1},"date":"2022-05-31","lastModifiedDate":"2022-05-31","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-standalone-react-application-341f"},"path":"implement-iframe-microfrontend/2022-05-31-part-1-standalone-react-application.md"},{"metadata":{"name":"Iframe Microfrontends: Angular Shell","series":{"name":"Iframe Microfrontends","part":2},"date":"2022-05-31","lastModifiedDate":"2022-05-31","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-angular-shell-pmj"},"path":"implement-iframe-microfrontend/2022-05-31-part-2-angular-shell-application.md"},{"metadata":{"name":"Iframe Microfrontends: Make React App Proper Iframe","series":{"name":"Iframe Microfrontends","part":3},"date":"2022-06-01","lastModifiedDate":"2022-06-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-make-react-app-proper-iframe-12g9"},"path":"implement-iframe-microfrontend/2022-06-01-part-3-make-react-app-proper-iframe.md"},{"metadata":{"name":"Create Singleton with ES2022","series":{"name":"Singleton","part":1},"date":"2022-06-25","lastModifiedDate":"2022-07-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","javascript"],"canonicalLink":"https://dev.to/bwca/create-singleton-with-es2022-51ic"},"path":"singleton/2022-06-25-part-1-create-singleton-with-es2022.md"},{"metadata":{"name":"Singleton Decorator","series":{"name":"Singleton","part":0},"date":"2022-07-01","lastModifiedDate":"2022-07-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/singleton-decorator-526h"},"path":"singleton/2022-07-01-part-0-singleton-decorator.md"}],"h":{},"s":200,"st":"OK","u":"./articles/index.json","rt":"json"},"3389833612":{"b":"```ic-metadata\r\n{\r\n  \"name\": \"Runtime Environment Config in Angular, but without Dependency Injection\",\r\n  \"series\": null,\r\n  \"date\": \"2024-06-08\",\r\n  \"lastModifiedDate\": \"2024-06-08\",\r\n  \"author\": \"Volodymyr Yepishev\",\r\n  \"tags\": [\"typescript\", \"tutorial\", \"angular\"],\r\n  \"canonicalLink\": \"https://dev.to/bwca/runtime-environment-config-in-angular-but-without-dependency-injection-kno\"\r\n}\r\n```\r\n\r\n# Runtime Environment Config in Angular, but without Dependency Injection\r\n\r\nCover image by Nightcafe, because Gemeni refuses to make images :/\r\n\r\nThe link to the repo for the code used in the article is provided at the end.\r\n\r\nConfiguring Angular to use environment variables packed in a json file, which is later pulled and provided by a dedicated service is a topic covered by several articles found on web. Yet, this approach sets a certain restriction on how the environment is provided, so it is no longer a ts import, but rather something provided inside Angular dependency injection system.\r\n\r\nIn this article we will take a look how to rewire Angular to use a json environment file, but without a separate service to provide it, in fact we are going to explore a way to preserve the environment.ts files for the dev experience. In the end we will be looking at environment.ts, which is transformed into environment.json, so the familiar way of using env files is preserved, at the same time new benefits of having a runtime configuration file is added. Which means migrating to the json file would not trigger any changes in the consuming components, which can be quite convenient if environment is used in many places.\r\n\r\nLet us consider we have a typed environment, which has the following model, nesting is for demo purposes, to make it look more complicated:\r\n\r\n```typescript\r\n// src/environments/models/environment.model.ts\r\nexport interface Environment {\r\n    api: string;\r\n    something: {\r\n        completely: {\r\n            different: string;\r\n        };\r\n    };\r\n}\r\n```\r\nAnd there is a consuming component that merely displays some values:\r\n```typescript\r\n// src/app/app.component.ts\r\nimport { Component } from '@angular/core';\r\n\r\nimport { environment } from '../environments/environment';\r\n\r\n@Component({\r\n    selector: 'app-root',\r\n    standalone: true,\r\n    template: `\u003Cp>\r\n        Api: {{ environment.api }}\r\n        \u003Cbr />\r\n        And now for something completely different:\r\n        {{ environment.something.completely.different }}\r\n    \u003C/p>`,\r\n})\r\nexport class AppComponent {\r\n    protected readonly environment = environment;\r\n}\r\n```\r\n\r\nLet us add an extra environment `environment.development.ts`, which is going to be a copy of `environment.ts`. We will be utilizing it for development, while `environment.ts` will be to preserve the imports.\r\n\r\nThis is our starting point, now we need to rewire the application to use environment configuration from a json file instead with minimal changes to `src/app` and no changes to `AppComponent`.\r\n\r\nThe first things that needs to be done is converting the environment typescript file into json. We could leverage `npx` and `ts-node` with some edgy inline magic to achieve that. Consider adding the following command to the scripts in `package.json` (I am using Windows, the amount of backslashes could different on a better OS):\r\n\r\n```json\r\n\"generate-env\": \"npx ts-node -O \\\"{\\\\\\\"module\\\\\\\":\\\\\\\"commonjs\\\\\\\"}\\\" -e \\\"const fs = require('fs'); const path = require('path'); const { environment } = require(path.join(process.cwd(), './src/environments/', (process.argv[1] || 'environment.development.ts'))); fs.writeFileSync(path.join(process.cwd(), './src/assets/environment.json'), JSON.stringify(environment));\\\"\"\r\n```\r\n\r\nLooks like a screenshot from war crimes in programming youtube video, I know. Essentially it is an inlined javascript snippet, here is how it looks formatted:\r\n```javascript\r\nconst fs = require('fs'); \r\nconst path = require('path'); \r\n\r\nconst { environment } = require(\r\n    path.join(process.cwd(), \r\n        './src/environments/', \r\n        (process.argv[1] || 'environment.development.ts')\r\n    )\r\n);\r\n\r\nfs.writeFileSync(\r\n    path.join(\r\n        process.cwd(), \r\n        './src/assets/environment.json'\r\n    ), \r\n    JSON.stringify(environment)\r\n);\r\n```\r\n\r\nAs you can see, nothing special happens, just a given environment file is converted into json and placed inside `/src/assets/environment.json`. If no environment file name is passed, default to be used is `environment.development.ts`.\r\n\r\nUpdating the `start` and `build` commands we get the following:\r\n```json\r\n\"start\": \"npm run generate-env && ng serve\",\r\n\"build\": \"npm run generate-env -- environment.production.ts && ng build\",\r\n```\r\n\r\nNow the json environment file is going to be generated every time the app is served in development mode or built for production.\r\n\r\nGenerated file is not yet used by anything, it has to be loaded in the app first. For the purpose of loading and consequently providing it, we will add a special class, `EnvironmentLoader`, which will have only static methods and properties. Think of it as a static class.\r\n\r\n```typescript\r\n// src/environments/utils/environment-loader.util.ts\r\nimport { Environment } from '../models/environment.model';\r\n\r\nexport class EnvironmentLoader {\r\n    private static env: Environment;\r\n\r\n    public static get environment(): Environment {\r\n        return EnvironmentLoader.env;\r\n    }\r\n\r\n    public static async loadEnvironment(): Promise\u003Cvoid> {\r\n        const response = await fetch('/assets/environment.json');\r\n        try {\r\n            EnvironmentLoader.env = await response.json();\r\n        } catch (e) {\r\n            console.log('Could not load config, oh no!');\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nIt uses fetch, so it is independent of Angular and does not need to depend on `HttpClientModule`. It has to run before the application is fully bootstrapped, so we have to use the `APP_INITIALIZER` token and create a provider for it:\r\n\r\n```typescript\r\n// src/environments/providers/provide-environment.provider.ts\r\nimport { APP_INITIALIZER, Provider } from '@angular/core';\r\n\r\nimport { EnvironmentLoader } from '../utils/environment-loader.util';\r\n\r\nexport const providerEnvironment: () => Provider = () => ({\r\n    provide: APP_INITIALIZER,\r\n    useFactory: () => () => EnvironmentLoader.loadEnvironment(),\r\n    multi: true,\r\n});\r\n```\r\n\r\nWith the provider in place, it is time to plug it into the application config:\r\n\r\n```typescript\r\n// src/app/app.config.ts\r\nimport { ApplicationConfig } from '@angular/core';\r\n\r\nimport { providerEnvironment } from '../environments/providers/provide-environment.provider';\r\n\r\nexport const appConfig: ApplicationConfig = {\r\n    providers: [providerEnvironment()],\r\n};\r\n```\r\n\r\nSo far so good. We have the mechanism to create a static json configuration file, we have means to fetch and store it before the application get bootstrapped, now comes the most interesting part: to wire up environment.ts to use the values from the json file without introducing changes to the consumers.\r\n\r\nEvery time a getter is fired on `environment` object from `environment.ts`, it should get its value from the appropriate field of `EnvironmentLoader.environment`, as those come from the json file. If you are thinking about Proxy, you are on the right path, but plain Proxy would not do as we have an object with several nesting levels. What we need is not just a one Proxy wrapper, but a factory, which could call itself and craft as many proxies on the fly, as we need, every time it encounters an object as a value, when a getter fires.\r\n\r\n```typescript\r\n// src/environments/utils/create-proxy.util.ts\r\nimport { EnvironmentLoader } from './environment-loader.util';\r\n\r\nexport function createProxy\u003CT extends object>(target: T, path = ''): T {\r\n    return new Proxy(target, {\r\n        get: function (obj, prop: string) {\r\n            const fullPath = path ? `${path}.${prop.toString()}` : prop;\r\n\r\n            const value = fullPath\r\n                .split('.')\r\n                .reduce((a, c) => a[c], EnvironmentLoader.environment as any);\r\n\r\n            if (value && typeof value === 'object') {\r\n                return createProxy(value, fullPath.toString());\r\n            }\r\n            return value;\r\n        },\r\n    });\r\n}\r\n```\r\n\r\nWhat is happening over there? Every time a getter fires, we calculate the path to the property and reach out to `EnvironmentLoader.environment` to get the value, if it is an object, we return another Proxy, passing the path along the way, once we reach the primitive value, we return it. This is how we counter paths like `environment.something.completely.different`.\r\n\r\nThis is all the heavy-lifting to be done, the only thing left is to update `environment.ts` and set it to proxy from our factory:\r\n\r\n```typescript\r\n// src/environments/environment.ts\r\nimport { Environment } from './models/environment.model';\r\nimport { createProxy } from './utils/create-proxy.util';\r\n\r\nexport const environment: Environment = createProxy({} as Environment);\r\n```\r\n\r\nIt is done now, the app is wired to a static configuration json file without any changes to consumers and no extra dependency injection. Just some ts/js magic. Now we can modify configuration after building the app, without having to rebuilt it. Something quite useful when you do not know where you deploy beforehand.\r\n\r\nBuild once, run anywhere, eh? :)\r\n\r\nP.S. the [poc repo](https://github.com/Bwca/demo_runtime-environment-config-in-angular-but-without-dependency-injection).","h":{},"s":200,"st":"OK","u":"./articles/2024-06-08-runtime-environment-config-in-angular-but-without-dependency-injection/2024-06-08-runtime-environment-config-in-angular-but-without-dependency-injection.md","rt":"text"},"__nghData__":[{},{"t":{"1":"t0"},"c":{"1":[{"i":"t0","r":3,"t":{"0":"t1","1":"t2"},"c":{"0":[],"1":[{"i":"t2","r":1}]},"x":2}]}},{"e":{"1":4},"t":{"2":"t4","3":"t5"},"c":{"2":[{"i":"t4","r":2,"e":{"0":1}}],"3":[]}},{"t":{"3":"t6"},"c":{"3":[]}},{"c":{"0":[]}},{"t":{"0":"t3","6":"t7"},"c":{"0":[{"i":"t3","r":1}],"6":[]},"n":{"3":"2f2"},"d":[5]},{"c":{"6":[{"i":"c1870341192","r":1}]}}]}</script></body></html>