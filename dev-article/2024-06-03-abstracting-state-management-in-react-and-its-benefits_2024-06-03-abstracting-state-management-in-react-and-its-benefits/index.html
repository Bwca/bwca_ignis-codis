<!DOCTYPE html><html lang="en-CA" dir="ltr" data-critters-container><head>
    <meta charset="utf-8">
    <title>Ignis Codis :  Abstracting State Management in React with Typescript, and its Benefits</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="logo.png">
  <style>:root{--theme-dark: #1e2019;--theme-dark-secondary: #393e41;--theme-light: #d3d0cb;--theme-accent: #e2c044;--theme-tertiary: #587b7f}button{transition:all .3s;color:var(--theme-accent)}button:hover,button:focus{background-color:var(--theme-accent);color:var(--theme-dark)}button{background-color:var(--theme-dark);border:1px solid var(--theme-accent);padding:.2rem 1rem;font-variant:small-caps;font-size:.9rem}body{font-size:1rem}h1{font-size:2.5rem}button{cursor:pointer}html{font-family:sans-serif,monospace}@media only screen and (max-width: 600px){html{font-size:16px}}@media only screen and (min-width: 600px){html{font-size:18px}}body{background-color:var(--theme-dark);color:var(--theme-light);padding:0;margin:0}*{transform:translateZ(0)}a{color:var(--theme-accent)}a:hover,a:focus{text-decoration:none;background-color:var(--theme-accent);color:var(--theme-dark)}markdown .language-ic-metadata{display:none}code[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}
</style><link rel="stylesheet" href="styles-4SQKIKAV.css" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles-4SQKIKAV.css"></noscript><style ng-app-id="ng">[_nghost-ng-c3775897885]{display:grid;height:100vh;overflow:hidden;box-sizing:border-box;width:auto;position:relative}@media only screen and (max-width: 600px){[_nghost-ng-c3775897885]{background:linear-gradient(to bottom,var(--theme-dark-secondary),var(--theme-dark) 80px 100%);padding:5px 0 0;grid-template-columns:1fr 1fr;grid-template-rows:auto 1fr auto;grid-template-areas:"logo social" "content content" "nav nav"}[_nghost-ng-c3775897885]   [data-ic-logo][_ngcontent-ng-c3775897885]{margin-left:30px}[_nghost-ng-c3775897885]   [data-ic-social-buttons][_ngcontent-ng-c3775897885]{justify-self:flex-end;margin-right:30px}[_nghost-ng-c3775897885]   main[_ngcontent-ng-c3775897885]{border-width:1px 0 0 0;border-style:solid;padding:10px;border-color:var(--theme-tertiary)}}@media only screen and (min-width: 600px){[_nghost-ng-c3775897885]{background:linear-gradient(to right,var(--theme-dark-secondary),var(--theme-dark) 125px 100%);padding:30px 0 30px 5px;grid-template-columns:100px 1fr;grid-template-rows:auto auto 1fr;grid-gap:20px;grid-template-areas:"logo content" "nav  content" "social content"}[_nghost-ng-c3775897885]   [data-ic-social-buttons][_ngcontent-ng-c3775897885]{justify-self:flex-start;align-self:flex-start}[_nghost-ng-c3775897885]   main[_ngcontent-ng-c3775897885]{border-width:0 0 0 1px;border-style:solid;border-color:var(--theme-tertiary)}}[data-ic-logo][_ngcontent-ng-c3775897885]{grid-area:logo}[data-ic-social-buttons][_ngcontent-ng-c3775897885]{grid-area:social;align-self:center}[data-ic-navigation][_ngcontent-ng-c3775897885]{grid-area:nav}main[_ngcontent-ng-c3775897885]{grid-area:content}main[_ngcontent-ng-c3775897885]   section[_ngcontent-ng-c3775897885]{max-width:800px}main[_ngcontent-ng-c3775897885]{overflow:auto;box-sizing:border-box;padding:30px;scrollbar-width:thin;scrollbar-color:var(--theme-light) var(--theme-tertiary)}</style><style ng-app-id="ng">[_nghost-ng-c1712305223]{display:flex}a[_ngcontent-ng-c1712305223]{display:block}a[_ngcontent-ng-c1712305223]:hover, a[_ngcontent-ng-c1712305223]:focus{background-color:transparent}img[_ngcontent-ng-c1712305223]{display:block;width:100%}@media only screen and (max-width: 600px){img[_ngcontent-ng-c1712305223]{max-width:55px}}@media only screen and (min-width: 600px){img[_ngcontent-ng-c1712305223]{max-width:150px}}</style><style ng-app-id="ng">a[_ngcontent-ng-c3947245871]{transition:all .3s;color:var(--theme-accent)}a[_ngcontent-ng-c3947245871]   [data-ic-icon][_ngcontent-ng-c3947245871]{--background-color: var(--theme-accent);padding:0}a[_ngcontent-ng-c3947245871]:hover, a[_ngcontent-ng-c3947245871]:focus{background-color:var(--theme-accent);color:var(--theme-dark)}a[_ngcontent-ng-c3947245871]:hover   [data-ic-icon][_ngcontent-ng-c3947245871], a[_ngcontent-ng-c3947245871]:focus   [data-ic-icon][_ngcontent-ng-c3947245871]{--background-color: var(--theme-dark)}a.active[_ngcontent-ng-c3947245871]{background-color:var(--theme-dark-secondary);cursor:unset;color:var(--theme-light)}a.active[_ngcontent-ng-c3947245871]   [data-ic-icon][_ngcontent-ng-c3947245871]{--background-color: var(--theme-light)}[_nghost-ng-c3947245871]{display:flex;align-items:center;justify-content:flex-end;width:100%}@media only screen and (min-width: 600px){[_nghost-ng-c3947245871]{justify-content:space-evenly}}a[_ngcontent-ng-c3947245871]{transition:all .3s;display:flex;border-radius:5px}a[_ngcontent-ng-c3947245871]{margin:10px}[data-ic-icon][_ngcontent-ng-c3947245871]{--font-size: 1.5rem}</style><style ng-app-id="ng">a[_ngcontent-ng-c632272801]{transition:all .3s;color:var(--theme-accent)}a[_ngcontent-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{--background-color: var(--theme-accent);padding:0}a[_ngcontent-ng-c632272801]:hover, a[_ngcontent-ng-c632272801]:focus{background-color:var(--theme-accent);color:var(--theme-dark)}a[_ngcontent-ng-c632272801]:hover   [data-ic-icon][_ngcontent-ng-c632272801], a[_ngcontent-ng-c632272801]:focus   [data-ic-icon][_ngcontent-ng-c632272801]{--background-color: var(--theme-dark)}a.active[_ngcontent-ng-c632272801]{background-color:var(--theme-dark-secondary);cursor:unset;color:var(--theme-light)}a.active[_ngcontent-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{--background-color: var(--theme-light)}[_nghost-ng-c632272801]{display:flex}@media only screen and (max-width: 600px){[_nghost-ng-c632272801]{flex-direction:row}[_nghost-ng-c632272801]   a[_ngcontent-ng-c632272801]{text-align:center;flex-grow:1}[_nghost-ng-c632272801]   .title[_ngcontent-ng-c632272801]{display:none}[_nghost-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{--font-size: 1.2rem}}@media only screen and (min-width: 600px){[_nghost-ng-c632272801]{flex-direction:column}[_nghost-ng-c632272801]   a[_ngcontent-ng-c632272801]{text-align:left}[_nghost-ng-c632272801]   [data-ic-icon][_ngcontent-ng-c632272801]{display:none}}a[_ngcontent-ng-c632272801]{background-color:var(--theme-dark);display:block;border:1px solid var(--theme-tertiary);box-sizing:border-box;padding:5px 15px;cursor:pointer;transition:all .3s;font-variant:small-caps;font-size:.9rem;text-decoration:none}</style><style ng-app-id="ng">[_nghost-ng-c1206199484]{--background-color: var(--theme-accent);--font-size: 1rem;display:contents}span[_ngcontent-ng-c1206199484]{background-color:var(--background-color);width:var(--font-size);height:var(--font-size)}a[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484]{background-color:var(--background-color)}a:hover[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a:hover   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a:active[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a:active   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484]{background-color:var(--background-color)}a.active[_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484], a.active   [_nghost-ng-c1206199484]   span[_ngcontent-ng-c1206199484]{background-color:var(--background-color)}</style><style ng-app-id="ng">.details[_ngcontent-ng-c2428032693]{margin-top:20px;font-size:.7rem;scrollbar-width:thin}.details[_ngcontent-ng-c2428032693]   .summary[_ngcontent-ng-c2428032693]{cursor:pointer;font-variant:small-caps}.article-metadata[_ngcontent-ng-c2428032693]{display:flex;flex-direction:column;justify-content:space-between;align-items:flex-start;flex-wrap:wrap}.article-metadata[_ngcontent-ng-c2428032693] > *[_ngcontent-ng-c2428032693]{padding:10px 0 0}@media only screen and (min-width: 600px){.article-metadata[_ngcontent-ng-c2428032693]{flex-direction:row}}</style><link rel="https://dev.to/bwca/abstracting-state-management-in-react-with-typescript-and-its-benefits-8mk"></head>
  <body><!--nghm-->
    <div data-ic-root _nghost-ng-c3775897885 class="ng-tns-c3775897885-0" ng-version="18.0.3" ngh="6" ng-server-context="ssg"><header _ngcontent-ng-c3775897885 data-ic-logo class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromTop" _nghost-ng-c1712305223 ngh="0"><a _ngcontent-ng-c1712305223 href="/home"><img _ngcontent-ng-c1712305223 src="./logo.png" alt="logo, depicting a ginger cat in a box"></a></header><nav _ngcontent-ng-c3775897885 data-ic-social-buttons class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromBottom" _nghost-ng-c3947245871 ngh="0"><a _ngcontent-ng-c3947245871 target="_blank" href="https://github.com/Bwca" title="GitHub"><span _ngcontent-ng-c3947245871 data-ic-icon iconname="github" _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/github.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span></a><a _ngcontent-ng-c3947245871 target="_blank" href="https://www.linkedin.com/in/volodymyr-yepishev" title="LinkedIn"><span _ngcontent-ng-c3947245871 data-ic-icon iconname="linkedin" _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/linkedin.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span></a></nav><nav _ngcontent-ng-c3775897885 data-ic-navigation class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromLeft" _nghost-ng-c632272801 ngh="1"><!----><a _ngcontent-ng-c632272801 routerlinkactive="active" title="home" href="/home" class="ng-star-inserted" style><span _ngcontent-ng-c632272801 data-ic-icon _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/home.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span><span _ngcontent-ng-c632272801 class="title">home</span></a><!----><!----><a _ngcontent-ng-c632272801 routerlinkactive="active" title="articles" href="/dev-articles" class="ng-star-inserted" style><span _ngcontent-ng-c632272801 data-ic-icon _nghost-ng-c1206199484 ngh="0"><span _ngcontent-ng-c1206199484 style="mask: url(icons/solid/book.svg) no-repeat center; display: inline-block; mask-size: 100%;"></span></span><span _ngcontent-ng-c632272801 class="title">articles</span></a><!----><!----></nav><main _ngcontent-ng-c3775897885 class="ng-tns-c3775897885-0 ng-trigger ng-trigger-slideInFromRight"><section _ngcontent-ng-c3775897885 class="ng-tns-c3775897885-0 ng-trigger ng-trigger-routeAnimations"><router-outlet _ngcontent-ng-c3775897885 class="ng-tns-c3775897885-0"></router-outlet><div _nghost-ng-c2428032693 data-ic-article-view class="ng-star-inserted" style ngh="5"><div _ngcontent-ng-c2428032693 data-ic-breadcrumbs _nghost-ng-c1373225446 class="ng-star-inserted" ngh="2"><div _ngcontent-ng-c1373225446><span _ngcontent-ng-c1373225446 class="ng-star-inserted"> / <a _ngcontent-ng-c1373225446 href="/dev-articles">Articles</a> /  Abstracting State Management in React with Typescript, and its Benefits </span><!----><!----><!----><!----></div></div><!----><!----><!----><section _ngcontent-ng-c2428032693 class="article-metadata"><section _ngcontent-ng-c2428032693 data-ic-accordion class="details ng-tns-c2942593920-1 ng-star-inserted" _nghost-ng-c2942593920 ngh="3"><button _ngcontent-ng-c2942593920 class="ng-tns-c2942593920-1"><span _ngcontent-ng-c2428032693 ngprojectas="summary" class="summary ng-tns-c2942593920-1">article metadata</span></button><br _ngcontent-ng-c2942593920 class="ng-tns-c2942593920-1"><!----></section><!----></section><section _ngcontent-ng-c2428032693 data-ic-markdown _nghost-ng-c1847889374 ngh="4"><markdown _ngcontent-ng-c1847889374 clipboard ngh="0"><pre><code class="language-ic-metadata">{
  "name": "Abstracting State Management in React with Typescript, and its Benefits",
  "series": null,
  "date": "2024-06-03",
  "lastModifiedDate": "2024-06-03",
  "author": "Volodymyr Yepishev",
  "tags": ["typescript", "tutorial", "angular"],
  "canonicalLink": "https://dev.to/bwca/abstracting-state-management-in-react-with-typescript-and-its-benefits-8mk"
}
</code></pre>
<h1>Abstracting State Management in React with Typescript, and its Benefits</h1>
<p><em>Bizarre illustration by Google Gemini AI.</em></p>
<p>State management is something unavoidable on the UI, be it local component scoped, or global, which in some enterprise applications can grow to gargantuan sizes.</p>
<p>The topic I would like to dwell upon today is tight coupling, which can be created by a state management library, how state management can be abstracted and what benefits and drawbacks it has. Perhaps it should be noted that for the applications that are not maintained in the long run or are short-lived, it does not really matter which state management tool is used or if there is an abstraction at all. Yet, those should be obvious.</p>
<p>As a part of this article we will take a look at <code>Redux</code> in a <code>React</code> application, the coupling it creates, how it can be abstracted and tested and how the state management tool can be swapped once the abstraction has been created, so the public api of the state management remains the same for the app, but the actual provider of it changes.</p>
<p>Firstly let us create a <code>React</code> application and add <code>Redux</code>:</p>
<pre><code class="language-bash">npx create-react-app demo_react-abstracting-state-management --template typescript &amp;&amp; install @reduxjs/toolkit react-redux
</code></pre>
<p>Following the <a href="https://react-redux.js.org/tutorials/typescript-quick-start">quick start</a> we can add a counter state, a component to render it, and get something similar to what is found in <a href="https://github.com/Bwca/demo_react-abstracting-state-management/commit/dc8bf22b6a947b0dc74edc3e0a6be9fe1bf0f703">this commit</a>.</p>
<p>Our counter slice is the following, it is almost identical to the one from the <code>Redux</code> quickstart:</p>
<pre><code class="language-typescript">import { createSlice, PayloadAction } from '@reduxjs/toolkit';

import type { RootState } from '../../store';

// Define a type for the slice state
interface CounterState {
    value: number;
}

// Define the initial state using that type
const initialState: CounterState = {
    value: 0,
};

export const counterSlice = createSlice({
    name: 'counter',
    // `createSlice` will infer the state type from the `initialState` argument
    initialState,
    reducers: {
        increment: (state) =&gt; {
            state.value += 1;
        },
        decrement: (state) =&gt; {
            state.value -= 1;
        },
        // Use the PayloadAction type to declare the contents of `action.payload`
        incrementByAmount: (state, action: PayloadAction&lt;number&gt;) =&gt; {
            state.value += action.payload;
        },
    },
});

export const { increment, decrement, incrementByAmount } = counterSlice.actions;
</code></pre>
<p>The noticeable difference is that we are placing <code>Redux</code>-related items in <code>store/redux</code>, because we intend to have abstraction in <code>store</code> and <code>store/redux</code> will be one of the implementations. The end goal is to provide an abstract exports from <code>store</code>, in a way that consumers are no longer coupled with a specific state management library.</p>
<p>Apart from a significant amount of boilerplate, which is not critical, what problem does it introduce to the application? The <code>Counter</code> component is now coupled with <code>Redux</code>, and so is our whole application, since it is wrapped in the <code>Redux</code> provider. While this is not a problem if your tech stack is married to <code>Redux</code>, this somewhat is limiting and coupling: changes to <code>Redux</code> in the long run could cause introducing changes to <code>Counter</code> component or other consumers, since all components utilizing imports from <code>Redux</code> will be coupled with it.</p>
<p>See the <code>Counter</code> component:</p>
<pre><code class="language-typescript">import { decrement, increment, useAppDispatch, useAppSelector } from '../../store/redux';

export const Counter = () =&gt; {
    const count = useAppSelector((state) =&gt; state.counter.value);
    const dispatch = useAppDispatch();

    return (
        &lt;div&gt;
            &lt;div&gt;
                &lt;button
                    aria-label="Increment value"
                    onClick={() =&gt; dispatch(increment())}
                &gt;
                    Increment
                &lt;/button&gt;
                &lt;span&gt;{count}&lt;/span&gt;
                &lt;button
                    aria-label="Decrement value"
                    onClick={() =&gt; dispatch(decrement())}
                &gt;
                    Decrement
                &lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    );
};
</code></pre>
<p>Were we to migrate to some other state management tool, the scope of change would be large as well, since <code>Redux</code> would have roots all over the place. You could consider it a soft form of vendor lock, when you could migrate, but the effort is not worth it, it is beneficial for libraries to impose such bounds, but not necessarily beneficial for your application, especially if a better alternative appears on the horizon.</p>
<p>Looking at the exposed state, we can deduct some abstractions: a model for state, a model for hook to access state and methods to modify it and a model for the state provider, which is a wrapper for our application.</p>
<p>Observe the <a href="https://github.com/Bwca/demo_react-abstracting-state-management/commit/bf69400fcfe6bd7998c8d9a3d57bc14fba16f4b4">following commit</a>.</p>
<p>So the state and managing methods can be expressed with the following interface:</p>
<pre><code class="language-typescript">// src/store/models/counter.state.ts
export interface CounterState {
    count: number;
    increment: () =&gt; void;
    decrement: () =&gt; void;
}
</code></pre>
<p>The hook delivering them would have the following functional interface:</p>
<pre><code class="language-typescript">// src/store/models/counter-state-hook.model.ts
import { CounterState } from './counter.state';

export interface CounterStateHook {
    (): CounterState;
}
</code></pre>
<p>And, finally, the provider:</p>
<pre><code class="language-typescript">// src/store/models/state-provider.model.ts
import { ReactElement, ReactNode } from 'react';

export interface StateProvider {
    (args: { children?: ReactNode }): ReactElement;
}
</code></pre>
<p>Evidently, the <code>Redux</code> items, currently present in our application hardly conform to these abstractions, and we would need to create an adapter to make things compliant, so let us create one, which will encapsulate <code>Redux</code> state management:</p>
<pre><code class="language-typescript">// src/store/redux/features/counter/counter-hook.ts
import { useCallback } from 'react';

import { useAppDispatch, useAppSelector } from '../../hooks';
import { decrement, increment } from './counter-slice';
import { CounterStateHook } from '../../../models';

export const useCounterHook: CounterStateHook = () =&gt; {
    const count = useAppSelector((state) =&gt; state.counter.value);

    const dispatch = useAppDispatch();

    const inc = useCallback(() =&gt; {
        dispatch(increment());
    }, [dispatch]);

    const dec = useCallback(() =&gt; {
        dispatch(decrement());
    }, [dispatch]);

    return {
        count,
        decrement: dec,
        increment: inc,
    };
};
</code></pre>
<p>Also, the <code>Redux</code> provider now needs to be adapted to conform to the provider interface:</p>
<pre><code class="language-typescript">// src/store/redux/StateProvider.tsx
import { Provider } from 'react-redux';

import { store } from './store';
import { StateProvider } from '../models';

export const StateContextProvider: StateProvider = ({ children }) =&gt; {
    return &lt;Provider store={store}&gt;{children}&lt;/Provider&gt;;
};
</code></pre>
<p>With these in place, we can now provide abstract exports from <code>store</code> which conceal the actual implementation of the underlying state management library.</p>
<p>Here goes our new state management provider:</p>
<pre><code class="language-typescript">// src/store/state.provider.ts
import { StateProvider as Provider } from './models';
import { StateContextProvider as ReduxStateContextProvider } from './redux';

export const StateProvider: Provider = ReduxStateContextProvider;
</code></pre>
<p>And the hook:</p>
<pre><code class="language-typescript">// src/store/counter.hook.ts
import { CounterStateHook } from './models';
import { useCounterHook as ReduxUseCounterHook } from './redux';

export const useCounter: CounterStateHook = ReduxUseCounterHook;
</code></pre>
<p>Which in turn means we can use them in <code>Counter</code>:</p>
<pre><code class="language-typescript">import { useCounter } from '../../store';

export const Counter = () =&gt; {
    const { increment, decrement, count } = useCounter();

    return (
        &lt;div&gt;
            &lt;div&gt;
                &lt;button aria-label="Increment value" onClick={increment}&gt;
                    Increment
                &lt;/button&gt;
                &lt;span&gt;{count}&lt;/span&gt;
                &lt;button aria-label="Decrement value" onClick={decrement}&gt;
                    Decrement
                &lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    );
};
</code></pre>
<p>The <code>Counter</code> no longer has any idea which library manages the state, or even if it s a library at all, which is good.</p>
<p>Now, provider for the app, and a small cleanup for imports:</p>
<pre><code class="language-typescript">// src/index.tsx
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';

import reportWebVitals from './reportWebVitals';

import { App } from './App';

import { StateProvider } from './store';

const root = createRoot(document.getElementById('root') as HTMLElement);
root.render(
    &lt;StrictMode&gt;
        &lt;StateProvider&gt;
            &lt;App /&gt;
        &lt;/StateProvider&gt;
    &lt;/StrictMode&gt;
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))
// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals
reportWebVitals();
</code></pre>
<p>Some state provider, no details, also good.</p>
<p>Now, before we proceed to migrate to a different state management tool, what we could do is write tests covering the public api of our <code>store</code> module, namely the <code>useCounter</code> hook, which we can do using <code>React Testing Library</code>:</p>
<pre><code class="language-typescript">import { act } from 'react';
import { renderHook } from '@testing-library/react';

import { useCounter } from './counter.hook';
import { StateProvider } from './state.provider';

describe('Tests for the counter state', () =&gt; {
    test('should increment counter', () =&gt; {
        const { result } = renderHook(useCounter, { wrapper: StateProvider });

        act(() =&gt; {
            result.current.increment();
        });

        expect(result.current.count).toBe(1);
    });

    test('should decrement counter', () =&gt; {
        const { result } = renderHook(useCounter, { wrapper: StateProvider });
        const current = result.current.count;

        act(() =&gt; {
            result.current.decrement();
        });

        expect(result.current.count).toBe(current - 1);
    });
});
</code></pre>
<p>Once we swap the implementation, the test will show us if everything is working, and we do not need to re-visit consumers.</p>
<p>As a poof of concept for state management tool migration, I chose <code>Zustand</code>, because all the kool kids write articles about it and I had never used it before. Apparently it is pronounced <code>/ˈʦuːʃtant/</code> and the name itself is taken from German, but don't take my word for it.</p>
<pre><code class="language-bash">npm i zustand
</code></pre>
<p>So we create a folder <code>zustand</code> next to the <code>redux</code>, it is going to be another implementation of our abstraction. It has no providers, so we would have to implement and empty one to comply with our abstraction (observe the <a href="https://github.com/Bwca/demo_react-abstracting-state-management/commit/1129c0070e20d89f9748ce32986e58a8d9177814">commit</a>):</p>
<pre><code class="language-typescript">// src/store/zustand/StateProvider.tsx
import { StateProvider } from '../models';

export const StateContextProvider: StateProvider = ({ children }) =&gt; {
    return &lt;&gt;{children}&lt;/&gt;;
};
</code></pre>
<p>However, its store creating function actually accepts and interface, and we can pass the existing one we created earlier, <code>CounterState</code>, which means no extra adapters, it will just work (which is amazingly convenient):</p>
<pre><code class="language-typescript">// src/store/zustand/counter.hook.ts
import { create } from 'zustand';
import { CounterState } from '../models';

export const useCounter = create&lt;CounterState&gt;((set) =&gt; ({
    count: 0,
    increment: () =&gt; set((state) =&gt; ({ count: state.count + 1 })),
    decrement: () =&gt; set((state) =&gt; ({ count: state.count - 1 })),
}));
</code></pre>
<p>All what is left is to swap implementations for the hook:</p>
<pre><code class="language-typescript">// src/store/counter.hook.ts
import { CounterStateHook } from './models';
import { useCounterHook as ReduxUseCounterHook } from './redux';
import { useCounter as ZustandUseCounterHook } from './zustand';

export const useCounter: CounterStateHook = ZustandUseCounterHook; // || ReduxUseCounterHook;
</code></pre>
<p>And the state provider:</p>
<pre><code class="language-typescript">// src/store/state.provider.ts
import { StateProvider as Provider } from './models';
import { StateContextProvider as ReduxStateContextProvider } from './redux';
import { StateContextProvider as ZustandStateProvider } from './zustand';

export const StateProvider: Provider = ZustandStateProvider; // || ReduxStateContextProvider;
</code></pre>
<p>We can run the tests now and make sure switching the underlying library, which does the heavy-lifting for state management had no impact on the <code>store</code> module's public api, which means the consuming components need no changes.</p>
<p>So to sum it up, what are the benefits? Looser coupling for components and state management, more flexibility, easier migration when changing the state management library. What are the drawbacks? Some abstraction overhead and need to write some interfaces to define public api and potentially adapters to make state management library comply.</p>
<p>That's it, have fun, the repo is <a href="https://github.com/Bwca/demo_react-abstracting-state-management">here</a> :)</p>
</markdown><!----></section></div><!----></section></main></div>
  <link rel="modulepreload" href="chunk-76TOWMZK.js"><script src="polyfills-UD7OJCHV.js" type="module"></script><script src="scripts-MI2AUGIN.js" defer></script><script src="main-PXGKGM4N.js" type="module"></script>

<script id="ng-state" type="application/json">{"341425767":{"b":[{"metadata":{"name":"Create a Custom eslint Rule with Typescript","series":null,"date":"2021-04-02","lastModifiedDate":"2021-07-11","author":"Volodymyr Yepishev","tags":["typescript","tutorial","eslint","npm"],"canonicalLink":"https://dev.to/bwca/create-a-custom-eslint-rule-with-typescript-4j3d"},"path":"2021-04-02-create-a-custom-eslint-rule-with-typescript.md"},{"metadata":{"name":"Create Object Property String Path Generator with Typescript","series":null,"date":"2021-04-13","lastModifiedDate":"2021-04-13","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular","react"],"canonicalLink":"https://dev.to/bwca/create-object-property-string-path-generator-with-typescript-13e3"},"path":"2021-04-13-create-object-property-string-path-generator-with-typescript/2021-04-13-create-object-property-string-path-generator-with-typescript.md"},{"metadata":{"name":"Build Entity-Friendly react-router Paths Generator with Typescript","series":null,"date":"2021-05-12","lastModifiedDate":"2021-05-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/build-entity-friendly-react-router-paths-generator-with-typescript-fpd"},"path":"2021-05-12-build-entity-friendly-react-router-path-generator-with-typescript.md"},{"metadata":{"name":"Split Collection Based on Enum Value with Typescript","series":null,"date":"2021-06-28","lastModifiedDate":"2021-06-28","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/split-collection-based-on-enum-value-with-typescript-4g3b"},"path":"2021-06-28-split-collection-based-on-enum-values/2021-06-28-split-collection-based-on-enum-values.md"},{"metadata":{"name":"Make Your Own Linkedin Promoted Posts Blocker","series":null,"date":"2021-07-14","lastModifiedDate":"2021-07-14","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/make-your-own-linkedin-promoted-posts-blocker-fj5"},"path":"2021-07-14-make-you-own-linkedin-promoted-posts-blocker.md"},{"metadata":{"name":"How I Decided to Write React cli and How it Went","series":null,"date":"2021-08-08","lastModifiedDate":"2021-08-08","author":"Volodymyr Yepishev","tags":["angular"],"canonicalLink":"https://dev.to/bwca/how-i-decided-to-write-react-cli-and-how-it-went-4f19"},"path":"2021-08-08-how-i-decided-to-write-react-cli-and-how-it-went/2021-08-08-how-i-decided-to-write-react-cli-and-how-it-went.md"},{"metadata":{"name":"Remove Double Imports with Regular Expression","series":null,"date":"2022-03-29","lastModifiedDate":"2022-03-29","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/remove-double-imports-with-regular-expression-47af"},"path":"2022-03-29-remove-double-imports-with-regular-expression.md"},{"metadata":{"name":"Decorating React Hook with Typescript","series":null,"date":"2022-04-12","lastModifiedDate":"2022-04-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/decorating-react-hook-with-typescript-bd9"},"path":"2022-04-12-decorating-react-hook-with-typescript.md"},{"metadata":{"name":"Override Method Return with a Decorator","series":null,"date":"2022-04-22","lastModifiedDate":"2022-04-22","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/override-method-return-with-a-decorator-1bii"},"path":"2022-04-22-change-api-response-with-a-decorator.md"},{"metadata":{"name":"Turn Angular Application into Chrome Extension","series":null,"date":"2022-05-25","lastModifiedDate":"2022-05-25","author":"Volodymyr Yepishev","tags":["angular","tutorial","chrome","extension"],"canonicalLink":"https://dev.to/bwca/turn-angular-application-into-chrome-extension-2mkn"},"path":"2022-05-25-turn-angular-application-into-chrome-extension.md"},{"metadata":{"name":"Typed Dates Conversion with Typescript","series":null,"date":"2022-06-30","lastModifiedDate":"2022-06-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","generics","conversion","date","moment"],"canonicalLink":"https://dev.to/bwca/typed-dates-conversion-with-typescript-49n7"},"path":"2022-06-30-typed-date-conversion-with-typescript.md"},{"metadata":{"name":"Weekday - Date - Month type","series":null,"date":"2022-07-29","lastModifiedDate":"2022-07-29","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/weekday-date-month-type-26j4"},"path":"2022-07-29-week-day-date-month-type.md"},{"metadata":{"name":"An Alternative Way of Creating Enumerations in Typescript","series":null,"date":"2022-08-03","lastModifiedDate":"2022-08-03","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/an-alternative-way-of-creating-enumerations-in-typescript-579k"},"path":"2022-08-03-an-alternative-way-of-creating-enumerations-in-typescript.md"},{"metadata":{"name":"Create a Static Class in Typescript","series":null,"date":"2022-08-12","lastModifiedDate":"2022-08-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/create-a-static-class-in-typescript-5ao1"},"path":"2022-08-12-create-static-class-in-typescript.md"},{"metadata":{"name":"Typescript Class Mixins","series":null,"date":"2022-08-20","lastModifiedDate":"2022-08-20","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/typescript-class-mixins-3hib"},"path":"2022-08-20-typescript-class-mixins.md"},{"metadata":{"name":"Using Classes Inside React's Functional Components","series":null,"date":"2022-08-22","lastModifiedDate":"2022-08-22","author":"Volodymyr Yepishev","tags":["typescript","react","tutorial"],"canonicalLink":"https://dev.to/bwca/using-classes-inside-reacts-functional-components-oj3"},"path":"2022-08-22-using-classes-inside-react-functional-component.md"},{"metadata":{"name":"Debouncing Component Methods in Angular","series":null,"date":"2022-08-29","lastModifiedDate":"2022-08-29","author":"Volodymyr Yepishev","tags":["typescript","angular","tutorial"],"canonicalLink":"https://dev.to/bwca/debouncing-component-methods-in-angular-34im"},"path":"2022-08-29-debouncing-component-methods-in-angular.md"},{"metadata":{"name":"A Trick to Further Breaking Down Angular Components","series":null,"date":"2022-09-02","lastModifiedDate":"2022-09-02","author":"Volodymyr Yepishev","tags":["typescript","angular"],"canonicalLink":"https://dev.to/bwca/a-trick-to-further-breaking-down-angular-components-1i8a"},"path":"2022-09-02-a-trick-to-further-breaking-angular-components.md"},{"metadata":{"name":"Typed Enum Flipping in Typescript","series":null,"date":"2022-11-09","lastModifiedDate":"2022-11-09","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/typed-enum-flipping-in-typescript-2ce9"},"path":"2022-11-09-typed-enum-flipping-in-typescript.md"},{"metadata":{"name":"Typed Filtering with Generics in Typescript","series":null,"date":"2022-12-01","lastModifiedDate":"2022-12-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","generics"],"canonicalLink":"https://dev.to/bwca/typed-filtering-with-generics-in-typescript-204f"},"path":"2022-12-01-typed-filtering-with-generics.md"},{"metadata":{"name":"Template Driving Reactive Form Validation in Angular","series":null,"date":"2023-05-15","lastModifiedDate":"2023-05-15","author":"Volodymyr Yepishev","tags":["angular"],"canonicalLink":"https://dev.to/bwca/template-driving-reactive-form-validation-in-angular-302e"},"path":"2023-05-15-template-driving-reactive-form-validation/2023-05-15-template-driving-reactive-form-validation-in-angular.md"},{"metadata":{"name":"Detect Invalid FormGroup Tree in Angular","series":null,"date":"2023-05-17","lastModifiedDate":"2023-05-17","author":"Volodymyr Yepishev","tags":["angular","debugger"],"canonicalLink":"https://dev.to/bwca/detect-invalid-formgroup-tree-in-angular-1ed"},"path":"2023-05-17-detect-invalid-form-group-tree-in-angular/2023-05-17-detect-invalid-form-group-tree-in-angular.md"},{"metadata":{"name":"Safe Route Param Injection in Angular with a Decorator","series":null,"date":"2023-07-22","lastModifiedDate":"2023-07-28","author":"Volodymyr Yepishev","tags":["angular","tutorial","routing","generics"],"canonicalLink":"https://dev.to/bwca/safe-route-param-injection-in-angular-with-a-decorator-1lk7"},"path":"2023-07-22-safe-route-param-injection-in-angular-with-a-decorator.md"},{"metadata":{"name":"Deep Readonly Generic in Typescript","series":null,"date":"2023-09-16","lastModifiedDate":"2024-06-26","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/deep-readonly-generic-in-typescript-4b04"},"path":"2023-09-16-deep-readonly-generic-in-typescript.md"},{"metadata":{"name":"Typing Object Keys With Enum Values Using Typescript","series":null,"date":"2023-11-01","lastModifiedDate":"2023-11-01","author":"Volodymyr Yepishev","tags":["typescript","generics","tutorial"],"canonicalLink":"https://dev.to/bwca/typing-object-keys-with-enum-values-using-typescript-4k23"},"path":"2023-11-01-typing-object-keys-with-enum-values-using-typescript.md"},{"metadata":{"name":"How to Create Bookmarklets Using External Libraries like React","series":null,"date":"2024-03-13","lastModifiedDate":"2024-03-13","author":"Volodymyr Yepishev","tags":["javascript","tutorial"],"canonicalLink":"https://dev.to/bwca/how-to-create-bookmarklets-using-libraries-like-react-2bhc"},"path":"2024-03-13-how-to-create-bookmarklets-using-external-libraries-like-react/2024-03-13-how-to-create-bookmarklets-using-external-libraries-like-react.md"},{"metadata":{"name":"Annoying Cat Extension","series":null,"date":"2024-03-29","lastModifiedDate":"2024-03-29","author":"Volodymyr Yepishev","tags":["javascript","tutorial"],"canonicalLink":"https://dev.to/bwca/annoying-cat-extension-4eaf"},"path":"2024-03-29-writing-annoying-image-browser-extension/2024-03-29-writing-annoying-image-browser-extension.md"},{"metadata":{"name":"Improving Dynamic Component Loader Typings in Angular Using Inputs","series":null,"date":"2024-04-15","lastModifiedDate":"2024-04-15","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular","generics"],"canonicalLink":"https://dev.to/bwca/improving-dynamic-component-loader-typings-in-angular-using-inputs-obl"},"path":"2024-04-15-improving-dynamic-component-loader-typings-in-angular-using-inputs/2024-04-15-improving-dynamic-component-loader-typings-in-angular-using-inputs.md"},{"metadata":{"name":"Reducing the Boilerplate for Services Utilizing Subjects in Angular","series":null,"date":"2024-05-06","lastModifiedDate":"2024-05-06","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular","rxjs"],"canonicalLink":"https://dev.to/bwca/reducing-the-boilerplate-for-services-utilizing-subjects-in-angular-44fp"},"path":"2024-05-06-reducing-the-boilerplate-for-stateful-services-in-angular/2024-05-06-reducing-the-boilerplate-for-stateful-services-in-angular.md"},{"metadata":{"name":"Crafting a Global State Hook in React","series":null,"date":"2024-05-18","lastModifiedDate":"2024-05-18","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react","state"],"canonicalLink":"https://dev.to/bwca/crafting-a-global-state-hook-in-react-4hb4"},"path":"2024-05-18-crafting-a-global-state-hook-in-react/2024-05-18-crafting-a-global-state-hook-in-react.md"},{"metadata":{"name":"Abstracting State Management in React with Typescript, and its Benefits","series":null,"date":"2024-06-03","lastModifiedDate":"2024-06-03","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular"],"canonicalLink":"https://dev.to/bwca/abstracting-state-management-in-react-with-typescript-and-its-benefits-8mk"},"path":"2024-06-03-abstracting-state-management-in-react-and-its-benefits/2024-06-03-abstracting-state-management-in-react-and-its-benefits.md"},{"metadata":{"name":"Runtime Environment Config in Angular, but without Dependency Injection","series":null,"date":"2024-06-08","lastModifiedDate":"2024-06-08","author":"Volodymyr Yepishev","tags":["typescript","tutorial","angular"],"canonicalLink":"https://dev.to/bwca/runtime-environment-config-in-angular-but-without-dependency-injection-kno"},"path":"2024-06-08-runtime-environment-config-in-angular-but-without-dependency-injection/2024-06-08-runtime-environment-config-in-angular-but-without-dependency-injection.md"},{"metadata":{"name":"Create a Debounce Function from Scratch in Typescript","series":{"name":"Implementing Debounce with Typescript","part":0},"date":"2021-08-26","lastModifiedDate":"2022-04-07","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/create-a-debounce-function-from-scratch-in-typescript-560m"},"path":"create-a-debounce-function-from-scratch-in-typescript/2021-08-26-part-0-create-a-debounce-function-from-scratch-in-typescript.md"},{"metadata":{"name":"Polish Types for the New Debounce Function","series":{"name":"Implementing Debounce with Typescript","part":1},"date":"2022-04-06","lastModifiedDate":"2022-04-06","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/polish-types-for-the-new-debounce-function-5e0n"},"path":"create-a-debounce-function-from-scratch-in-typescript/2022-04-06-part-1-polish-types-for-the-new-debounce-function.md"},{"metadata":{"name":"Caching Decorator","series":{"name":"Decorator Memoization","part":0},"date":"2022-06-06","lastModifiedDate":"2024-06-26","author":"Volodymyr Yepishev","tags":["typescript","tutorial","decorators"],"canonicalLink":"https://dev.to/bwca/caching-decorator-52e1"},"path":"decorator-memoization/2022-06-06-part-0-caching-decorator.md"},{"metadata":{"name":"Memoize Decorator","series":{"name":"Decorator Memoization","part":1},"date":"2022-07-12","lastModifiedDate":"2022-07-12","author":"Volodymyr Yepishev","tags":["typescript","tutorial","decorators"],"canonicalLink":"https://dev.to/bwca/memoize-decorator-5aoo"},"path":"decorator-memoization/2022-07-12-part-1-memoize-decorator.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 0: Intro","series":{"name":"Implementing React Check Permissions","part":0},"date":"2021-10-29","lastModifiedDate":"2021-10-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-reach-check-permissions-part-0-intro-1inc"},"path":"impementing-react-check-permission/2021-10-29-part-0-intro.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 1: Check Permissions Function","series":{"name":"Implementing React Check Permissions","part":1},"date":"2021-10-30","lastModifiedDate":"2021-10-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-reach-check-permissions-part-1-check-permissions-function-136l"},"path":"impementing-react-check-permission/2021-10-30-part-1-check-permissions-function.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 2: Check Permissions Hook","series":{"name":"Implementing React Check Permissions","part":2},"date":"2021-11-01","lastModifiedDate":"2021-11-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-react-check-permissions-the-hook-3m20"},"path":"impementing-react-check-permission/2021-11-01-part-2-use-check-permissions.md"},{"metadata":{"name":"Implementing React Check Permissions. Part 3: with Permissions Component","series":{"name":"Implementing React Check Permissions","part":3},"date":"2021-11-04","lastModifiedDate":"2021-11-04","author":"Volodymyr Yepishev","tags":["typescript","tutorial","react"],"canonicalLink":"https://dev.to/bwca/implementing-react-check-permissions-the-component-3gjm"},"path":"impementing-react-check-permission/2021-11-04-part-3-with-permissions-component.md"},{"metadata":{"name":"Iframe Microfrontends: Intro and Setup","series":{"name":"Iframe Microfrontends","part":0},"date":"2022-05-30","lastModifiedDate":"2022-05-30","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-intro-and-setup-1g7h"},"path":"implement-iframe-microfrontend/2022-05-30-part-0-intro-and-setup.md"},{"metadata":{"name":"Iframe Microfrontends: Standalone React Application","series":{"name":"Iframe Microfrontends","part":1},"date":"2022-05-31","lastModifiedDate":"2022-05-31","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-standalone-react-application-341f"},"path":"implement-iframe-microfrontend/2022-05-31-part-1-standalone-react-application.md"},{"metadata":{"name":"Iframe Microfrontends: Angular Shell","series":{"name":"Iframe Microfrontends","part":2},"date":"2022-05-31","lastModifiedDate":"2022-05-31","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-angular-shell-pmj"},"path":"implement-iframe-microfrontend/2022-05-31-part-2-angular-shell-application.md"},{"metadata":{"name":"Iframe Microfrontends: Make React App Proper Iframe","series":{"name":"Iframe Microfrontends","part":3},"date":"2022-06-01","lastModifiedDate":"2022-06-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","microfrontends","react","angular"],"canonicalLink":"https://dev.to/bwca/iframe-microfrontends-make-react-app-proper-iframe-12g9"},"path":"implement-iframe-microfrontend/2022-06-01-part-3-make-react-app-proper-iframe.md"},{"metadata":{"name":"Create Singleton with ES2022","series":{"name":"Singleton","part":1},"date":"2022-06-25","lastModifiedDate":"2022-07-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial","javascript"],"canonicalLink":"https://dev.to/bwca/create-singleton-with-es2022-51ic"},"path":"singleton/2022-06-25-part-1-create-singleton-with-es2022.md"},{"metadata":{"name":"Singleton Decorator","series":{"name":"Singleton","part":0},"date":"2022-07-01","lastModifiedDate":"2022-07-01","author":"Volodymyr Yepishev","tags":["typescript","tutorial"],"canonicalLink":"https://dev.to/bwca/singleton-decorator-526h"},"path":"singleton/2022-07-01-part-0-singleton-decorator.md"}],"h":{},"s":200,"st":"OK","u":"./articles/index.json","rt":"json"},"1312996132":{"b":"```ic-metadata\r\n{\r\n  \"name\": \"Abstracting State Management in React with Typescript, and its Benefits\",\r\n  \"series\": null,\r\n  \"date\": \"2024-06-03\",\r\n  \"lastModifiedDate\": \"2024-06-03\",\r\n  \"author\": \"Volodymyr Yepishev\",\r\n  \"tags\": [\"typescript\", \"tutorial\", \"angular\"],\r\n  \"canonicalLink\": \"https://dev.to/bwca/abstracting-state-management-in-react-with-typescript-and-its-benefits-8mk\"\r\n}\r\n```\r\n\r\n# Abstracting State Management in React with Typescript, and its Benefits\r\n\r\n_Bizarre illustration by Google Gemini AI._\r\n\r\nState management is something unavoidable on the UI, be it local component scoped, or global, which in some enterprise applications can grow to gargantuan sizes.\r\n\r\nThe topic I would like to dwell upon today is tight coupling, which can be created by a state management library, how state management can be abstracted and what benefits and drawbacks it has. Perhaps it should be noted that for the applications that are not maintained in the long run or are short-lived, it does not really matter which state management tool is used or if there is an abstraction at all. Yet, those should be obvious.\r\n\r\nAs a part of this article we will take a look at `Redux` in a `React` application, the coupling it creates, how it can be abstracted and tested and how the state management tool can be swapped once the abstraction has been created, so the public api of the state management remains the same for the app, but the actual provider of it changes.\r\n\r\nFirstly let us create a `React` application and add `Redux`:\r\n```bash\r\nnpx create-react-app demo_react-abstracting-state-management --template typescript && install @reduxjs/toolkit react-redux\r\n```\r\n\r\nFollowing the [quick start](https://react-redux.js.org/tutorials/typescript-quick-start) we can add a counter state, a component to render it, and get something similar to what is found in [this commit](https://github.com/Bwca/demo_react-abstracting-state-management/commit/dc8bf22b6a947b0dc74edc3e0a6be9fe1bf0f703).\r\n\r\nOur counter slice is the following, it is almost identical to the one from the `Redux` quickstart:\r\n```typescript\r\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\n\r\nimport type { RootState } from '../../store';\r\n\r\n// Define a type for the slice state\r\ninterface CounterState {\r\n    value: number;\r\n}\r\n\r\n// Define the initial state using that type\r\nconst initialState: CounterState = {\r\n    value: 0,\r\n};\r\n\r\nexport const counterSlice = createSlice({\r\n    name: 'counter',\r\n    // `createSlice` will infer the state type from the `initialState` argument\r\n    initialState,\r\n    reducers: {\r\n        increment: (state) => {\r\n            state.value += 1;\r\n        },\r\n        decrement: (state) => {\r\n            state.value -= 1;\r\n        },\r\n        // Use the PayloadAction type to declare the contents of `action.payload`\r\n        incrementByAmount: (state, action: PayloadAction\u003Cnumber>) => {\r\n            state.value += action.payload;\r\n        },\r\n    },\r\n});\r\n\r\nexport const { increment, decrement, incrementByAmount } = counterSlice.actions;\r\n```\r\n\r\nThe noticeable difference is that we are placing `Redux`-related items in `store/redux`, because we intend to have abstraction in `store` and `store/redux` will be one of the implementations. The end goal is to provide an abstract exports from `store`, in a way that consumers are no longer coupled with a specific state management library.\r\n\r\nApart from a significant amount of boilerplate, which is not critical, what problem does it introduce to the application? The `Counter` component is now coupled with `Redux`, and so is our whole application, since it is wrapped in the `Redux` provider. While this is not a problem if your tech stack is married to `Redux`, this somewhat is limiting and coupling: changes to `Redux` in the long run could cause introducing changes to `Counter` component or other consumers, since all components utilizing imports from `Redux` will be coupled with it.\r\n\r\nSee the `Counter` component:\r\n```typescript\r\nimport { decrement, increment, useAppDispatch, useAppSelector } from '../../store/redux';\r\n\r\nexport const Counter = () => {\r\n    const count = useAppSelector((state) => state.counter.value);\r\n    const dispatch = useAppDispatch();\r\n\r\n    return (\r\n        \u003Cdiv>\r\n            \u003Cdiv>\r\n                \u003Cbutton\r\n                    aria-label=\"Increment value\"\r\n                    onClick={() => dispatch(increment())}\r\n                >\r\n                    Increment\r\n                \u003C/button>\r\n                \u003Cspan>{count}\u003C/span>\r\n                \u003Cbutton\r\n                    aria-label=\"Decrement value\"\r\n                    onClick={() => dispatch(decrement())}\r\n                >\r\n                    Decrement\r\n                \u003C/button>\r\n            \u003C/div>\r\n        \u003C/div>\r\n    );\r\n};\r\n```\r\n\r\nWere we to migrate to some other state management tool, the scope of change would be large as well, since `Redux` would have roots all over the place. You could consider it a soft form of vendor lock, when you could migrate, but the effort is not worth it, it is beneficial for libraries to impose such bounds, but not necessarily beneficial for your application, especially if a better alternative appears on the horizon.\r\n\r\nLooking at the exposed state, we can deduct some abstractions: a model for state, a model for hook to access state and methods to modify it and a model for the state provider, which is a wrapper for our application.\r\n\r\nObserve the [following commit](https://github.com/Bwca/demo_react-abstracting-state-management/commit/bf69400fcfe6bd7998c8d9a3d57bc14fba16f4b4).\r\n\r\nSo the state and managing methods can be expressed with the following interface:\r\n\r\n```typescript\r\n// src/store/models/counter.state.ts\r\nexport interface CounterState {\r\n    count: number;\r\n    increment: () => void;\r\n    decrement: () => void;\r\n}\r\n```\r\n\r\nThe hook delivering them would have the following functional interface:\r\n```typescript\r\n// src/store/models/counter-state-hook.model.ts\r\nimport { CounterState } from './counter.state';\r\n\r\nexport interface CounterStateHook {\r\n    (): CounterState;\r\n}\r\n```\r\n\r\nAnd, finally, the provider:\r\n```typescript\r\n// src/store/models/state-provider.model.ts\r\nimport { ReactElement, ReactNode } from 'react';\r\n\r\nexport interface StateProvider {\r\n    (args: { children?: ReactNode }): ReactElement;\r\n}\r\n```\r\n\r\nEvidently, the `Redux` items, currently present in our application hardly conform to these abstractions, and we would need to create an adapter to make things compliant, so let us create one, which will encapsulate `Redux` state management:\r\n\r\n```typescript\r\n// src/store/redux/features/counter/counter-hook.ts\r\nimport { useCallback } from 'react';\r\n\r\nimport { useAppDispatch, useAppSelector } from '../../hooks';\r\nimport { decrement, increment } from './counter-slice';\r\nimport { CounterStateHook } from '../../../models';\r\n\r\nexport const useCounterHook: CounterStateHook = () => {\r\n    const count = useAppSelector((state) => state.counter.value);\r\n\r\n    const dispatch = useAppDispatch();\r\n\r\n    const inc = useCallback(() => {\r\n        dispatch(increment());\r\n    }, [dispatch]);\r\n\r\n    const dec = useCallback(() => {\r\n        dispatch(decrement());\r\n    }, [dispatch]);\r\n\r\n    return {\r\n        count,\r\n        decrement: dec,\r\n        increment: inc,\r\n    };\r\n};\r\n```\r\n\r\nAlso, the `Redux` provider now needs to be adapted to conform to the provider interface:\r\n```typescript\r\n// src/store/redux/StateProvider.tsx\r\nimport { Provider } from 'react-redux';\r\n\r\nimport { store } from './store';\r\nimport { StateProvider } from '../models';\r\n\r\nexport const StateContextProvider: StateProvider = ({ children }) => {\r\n    return \u003CProvider store={store}>{children}\u003C/Provider>;\r\n};\r\n```\r\n\r\nWith these in place, we can now provide abstract exports from `store` which conceal the actual implementation of the underlying state management library.\r\n\r\nHere goes our new state management provider:\r\n```typescript\r\n// src/store/state.provider.ts\r\nimport { StateProvider as Provider } from './models';\r\nimport { StateContextProvider as ReduxStateContextProvider } from './redux';\r\n\r\nexport const StateProvider: Provider = ReduxStateContextProvider;\r\n```\r\n\r\nAnd the hook:\r\n```typescript\r\n// src/store/counter.hook.ts\r\nimport { CounterStateHook } from './models';\r\nimport { useCounterHook as ReduxUseCounterHook } from './redux';\r\n\r\nexport const useCounter: CounterStateHook = ReduxUseCounterHook;\r\n```\r\n\r\nWhich in turn means we can use them in `Counter`:\r\n```typescript\r\nimport { useCounter } from '../../store';\r\n\r\nexport const Counter = () => {\r\n    const { increment, decrement, count } = useCounter();\r\n\r\n    return (\r\n        \u003Cdiv>\r\n            \u003Cdiv>\r\n                \u003Cbutton aria-label=\"Increment value\" onClick={increment}>\r\n                    Increment\r\n                \u003C/button>\r\n                \u003Cspan>{count}\u003C/span>\r\n                \u003Cbutton aria-label=\"Decrement value\" onClick={decrement}>\r\n                    Decrement\r\n                \u003C/button>\r\n            \u003C/div>\r\n        \u003C/div>\r\n    );\r\n};\r\n```\r\n\r\nThe `Counter` no longer has any idea which library manages the state, or even if it s a library at all, which is good.\r\n\r\nNow, provider for the app, and a small cleanup for imports:\r\n```typescript\r\n// src/index.tsx\r\nimport { StrictMode } from 'react';\r\nimport { createRoot } from 'react-dom/client';\r\n\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nimport { App } from './App';\r\n\r\nimport { StateProvider } from './store';\r\n\r\nconst root = createRoot(document.getElementById('root') as HTMLElement);\r\nroot.render(\r\n    \u003CStrictMode>\r\n        \u003CStateProvider>\r\n            \u003CApp />\r\n        \u003C/StateProvider>\r\n    \u003C/StrictMode>\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n```\r\n\r\nSome state provider, no details, also good.\r\n\r\nNow, before we proceed to migrate to a different state management tool, what we could do is write tests covering the public api of our `store` module, namely the `useCounter` hook, which we can do using `React Testing Library`:\r\n\r\n```typescript\r\nimport { act } from 'react';\r\nimport { renderHook } from '@testing-library/react';\r\n\r\nimport { useCounter } from './counter.hook';\r\nimport { StateProvider } from './state.provider';\r\n\r\ndescribe('Tests for the counter state', () => {\r\n    test('should increment counter', () => {\r\n        const { result } = renderHook(useCounter, { wrapper: StateProvider });\r\n\r\n        act(() => {\r\n            result.current.increment();\r\n        });\r\n\r\n        expect(result.current.count).toBe(1);\r\n    });\r\n\r\n    test('should decrement counter', () => {\r\n        const { result } = renderHook(useCounter, { wrapper: StateProvider });\r\n        const current = result.current.count;\r\n\r\n        act(() => {\r\n            result.current.decrement();\r\n        });\r\n\r\n        expect(result.current.count).toBe(current - 1);\r\n    });\r\n});\r\n```\r\n\r\nOnce we swap the implementation, the test will show us if everything is working, and we do not need to re-visit consumers.\r\n\r\nAs a poof of concept for state management tool migration, I chose `Zustand`, because all the kool kids write articles about it and I had never used it before. Apparently it is pronounced `/ˈʦuːʃtant/` and the name itself is taken from German, but don't take my word for it.\r\n\r\n```bash\r\nnpm i zustand\r\n```\r\n\r\nSo we create a folder `zustand` next to the `redux`, it is going to be another implementation of our abstraction. It has no providers, so we would have to implement and empty one to comply with our abstraction (observe the [commit](https://github.com/Bwca/demo_react-abstracting-state-management/commit/1129c0070e20d89f9748ce32986e58a8d9177814)):\r\n```typescript\r\n// src/store/zustand/StateProvider.tsx\r\nimport { StateProvider } from '../models';\r\n\r\nexport const StateContextProvider: StateProvider = ({ children }) => {\r\n    return \u003C>{children}\u003C/>;\r\n};\r\n```\r\n\r\nHowever, its store creating function actually accepts and interface, and we can pass the existing one we created earlier, `CounterState`, which means no extra adapters, it will just work (which is amazingly convenient):\r\n\r\n```typescript\r\n// src/store/zustand/counter.hook.ts\r\nimport { create } from 'zustand';\r\nimport { CounterState } from '../models';\r\n\r\nexport const useCounter = create\u003CCounterState>((set) => ({\r\n    count: 0,\r\n    increment: () => set((state) => ({ count: state.count + 1 })),\r\n    decrement: () => set((state) => ({ count: state.count - 1 })),\r\n}));\r\n```\r\n\r\nAll what is left is to swap implementations for the hook:\r\n```typescript\r\n// src/store/counter.hook.ts\r\nimport { CounterStateHook } from './models';\r\nimport { useCounterHook as ReduxUseCounterHook } from './redux';\r\nimport { useCounter as ZustandUseCounterHook } from './zustand';\r\n\r\nexport const useCounter: CounterStateHook = ZustandUseCounterHook; // || ReduxUseCounterHook;\r\n```\r\n\r\nAnd the state provider:\r\n```typescript\r\n// src/store/state.provider.ts\r\nimport { StateProvider as Provider } from './models';\r\nimport { StateContextProvider as ReduxStateContextProvider } from './redux';\r\nimport { StateContextProvider as ZustandStateProvider } from './zustand';\r\n\r\nexport const StateProvider: Provider = ZustandStateProvider; // || ReduxStateContextProvider;\r\n```\r\n\r\nWe can run the tests now and make sure switching the underlying library, which does the heavy-lifting for state management had no impact on the `store` module's public api, which means the consuming components need no changes.\r\n\r\nSo to sum it up, what are the benefits? Looser coupling for components and state management, more flexibility, easier migration when changing the state management library. What are the drawbacks? Some abstraction overhead and need to write some interfaces to define public api and potentially adapters to make state management library comply.\r\n\r\nThat's it, have fun, the repo is [here](https://github.com/Bwca/demo_react-abstracting-state-management) :)","h":{},"s":200,"st":"OK","u":"./articles/2024-06-03-abstracting-state-management-in-react-and-its-benefits/2024-06-03-abstracting-state-management-in-react-and-its-benefits.md","rt":"text"},"__nghData__":[{},{"t":{"1":"t0"},"c":{"1":[{"i":"t0","r":3,"t":{"0":"t1","1":"t2"},"c":{"0":[],"1":[{"i":"t2","r":1}]},"x":2}]}},{"e":{"1":4},"t":{"2":"t6","3":"t7"},"c":{"2":[{"i":"t6","r":2,"e":{"0":1}}],"3":[]}},{"t":{"3":"t8"},"c":{"3":[]}},{"c":{"0":[]}},{"t":{"0":"t3","2":"t4","9":"t9"},"c":{"0":[{"i":"t4","r":2,"t":{"0":"t5"},"c":{"0":[{"i":"t5","r":1}]}}],"2":[],"9":[]},"n":{"6":"5f2"},"d":[8]},{"c":{"6":[{"i":"c2428032693","r":1}]}}]}</script></body></html>